image: test

# https://docs.gitlab.com/ee/ci/yaml/#parallel
test:
  script: rspec
  parallel: 5

# https://docs.gitlab.com/ee/ci/yaml/#parallelmatrix
deploystacks:
  stage: deploy
  script:
    - bin/deploy
  parallel:
    matrix:
      - PROVIDER: aws
        STACK:
          - monitoring
          - app1
          - app2
      - PROVIDER: ovh
        STACK: [monitoring, backup, app]
      - PROVIDER: [gcp, vultr]
        STACK: [data, processing]
  environment: $PROVIDER/$STACK

invalid:
  parallel: []
