<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MongoUserDict &#8212; mongo_objects 1.2.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=36f53d34"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Proxy Overview" href="proxy_overview.html" />
    <link rel="prev" title="Sample Application" href="sample.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="mongouserdict">
<h1>MongoUserDict<a class="headerlink" href="#mongouserdict" title="Link to this heading">¶</a></h1>
<section id="basic-usage">
<h2>Basic Usage<a class="headerlink" href="#basic-usage" title="Link to this heading">¶</a></h2>
<p>By subclassing <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoUserDict</span></code> you can manage MongoDB documents with your own
custom classes. <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoUserDict</span></code> is itself a subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">UserDict</span></code> and
supports all dictionary access methods.</p>
<p>To define your class, provide the <code class="xref py py-mod docutils literal notranslate"><span class="pre">pymongo</span></code> database object and the name of the
collection:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mongo_objects</span>

<span class="k">class</span> <span class="nc">Event</span><span class="p">(</span> <span class="n">mongo_objects</span><span class="o">.</span><span class="n">MongoUserDict</span> <span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="o">...</span>          <span class="c1"># provide your pymongo database object here</span>
    <span class="n">collection_name</span> <span class="o">=</span> <span class="s1">&#39;events&#39;</span>
</pre></div>
</div>
</section>
<section id="crud-operations">
<h2>CRUD Operations<a class="headerlink" href="#crud-operations" title="Link to this heading">¶</a></h2>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">mongo_objects</span></code> supports all CRUD (create, read, update, delete) operations.</p>
<p>Create an object by creating an instance of your <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoUserDict</span></code> subclass:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span> <span class="p">{</span>
    <span class="o">...</span> <span class="n">document</span> <span class="n">data</span> <span class="n">here</span> <span class="o">...</span>
<span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>Saving a new object will write it to the database and assign it a MongoDB ObjectId.
<em>_created</em> and <em>_updated</em> timestamps will also be added to the document:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">event</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>To load multiple documents, use the familiar <code class="xref py py-meth docutils literal notranslate"><span class="pre">find()</span></code> method. Filter, template
and other arguments are passed to the underlying <code class="xref py py-meth docutils literal notranslate"><span class="pre">pymongo.find()</span></code>.
The resulting documents are returned as instances of your <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoUserDict</span></code> document
subclass:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">Event</span><span class="o">.</span><span class="n">find</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Single documents may be loaded with <code class="xref py py-meth docutils literal notranslate"><span class="pre">find_one()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">find_one</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_by_id()</span></code> is a convenience method to load a document by its MongoDB ObjectId.
The method accepts either a string or BSON ObjectId:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">load_by_id</span><span class="p">(</span> <span class="s1">&#39;662b0d705a4c657820625300&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<p>To update an document, simply update the instance of your document class with
the usual methods for modifying dictionaries and then <code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code> it.
For existing documents (i.e. documents that already have a MongoDB ObjectId),
<code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code> automatically uses <code class="xref py py-meth docutils literal notranslate"><span class="pre">pymongo.find_one_and_replace()</span></code>
to update the existing document in place.</p>
<p>To prevent overwriting modified data, <code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code> will only
replace objects that haven’t
already been modified in the database.
See the <code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code> method reference for more details on this behavior.</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code> updates the <em>_updated</em> timestamp to the current UTC time for all objects
successfully saved.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;new-key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;add some content to the object&#39;</span>
<span class="n">event</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Deleting an object is accomplished with the <code class="xref py py-meth docutils literal notranslate"><span class="pre">delete()</span></code> method. The document is deleted from
the database and the ObjectId is removed from the in-memory object. If the object is
saved again, it will be treated as a new document.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">event</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="read-only-documents">
<h2>Read-Only Documents<a class="headerlink" href="#read-only-documents" title="Link to this heading">¶</a></h2>
<p>It is possible to use projections that return incomplete documents
that can’t be safely be saved by <code class="xref py py-mod docutils literal notranslate"><span class="pre">mongo_objects</span></code> without data loss.
<code class="xref py py-mod docutils literal notranslate"><span class="pre">mongo_objects</span></code> doesn’t attempt to determine whether a projection
is safe or not.</p>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">find()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">find_one()</span></code> methods accept a <em>readonly</em> keyword argument with
three potential values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code> (default): All documents created with a projection are marked readonly.
All other documents are considered read-write.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code>: The documents will be marked as readonly.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span></code>: The documents will be considered read-write.
This is a potentially dangerous choice. With great power comes great responsibility.</p></li>
</ul>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code> refuses to save a readonly object and raises a <code class="xref py py-exc docutils literal notranslate"><span class="pre">MongoObjectsReadOnly</span></code>
exception instead.</p>
</section>
<section id="document-ids">
<h2>Document IDs<a class="headerlink" href="#document-ids" title="Link to this heading">¶</a></h2>
<p>Once a document has been saved and an ObjectId assigned by MongoDB, the <code class="xref py py-meth docutils literal notranslate"><span class="pre">id()</span></code>
method returns a string representation of the ObjectId.</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_by_id()</span></code> may be used to load a specific document by its ObjectId or
by the string returned by <code class="xref py py-meth docutils literal notranslate"><span class="pre">id()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># load a random document</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">find_one</span><span class="p">()</span>

<span class="c1"># save the ObjectId for later</span>
<span class="n">eventId</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>

<span class="o">...</span> <span class="n">time</span> <span class="n">passes</span> <span class="o">...</span>

<span class="c1"># reload the document from its ObjectId</span>
<span class="n">event_again</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">load_by_id</span><span class="p">(</span> <span class="n">eventId</span> <span class="p">)</span>
</pre></div>
</div>
<p>ObjectIds are represented as lowercase hex digits, so the result of <code class="xref py py-meth docutils literal notranslate"><span class="pre">id()</span></code>
is safe to use in URLs.</p>
</section>
<section id="authorization">
<h2>Authorization<a class="headerlink" href="#authorization" title="Link to this heading">¶</a></h2>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">mongo_objects</span></code> does not implement any authorization itself, but does provide
the following hooks that the user may override to implement access control over
each CRUD action.</p>
<section id="create">
<h3>Create<a class="headerlink" href="#create" title="Link to this heading">¶</a></h3>
<p>Creating new objects is authorized by the <a class="reference internal" href="#mongo_objects.MongoUserDict.authorize_init" title="mongo_objects.MongoUserDict.authorize_init"><code class="xref py py-meth docutils literal notranslate"><span class="pre">authorize_init()</span></code></a> method. The method
may inspect the contents of the document to see if creating it is allowed. Since
reading documents from the database also involves creating a new object, this
method will also be called for each <code class="xref py py-meth docutils literal notranslate"><span class="pre">find()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">find_one()</span></code> document as well.
If the method does not return <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="xref py py-exc docutils literal notranslate"><span class="pre">MongoObjectsAuthFailed</span></code> exception is raised.</p>
</section>
<section id="read">
<h3>Read<a class="headerlink" href="#read" title="Link to this heading">¶</a></h3>
<p>There are two read hooks:</p>
<p><a class="reference internal" href="#mongo_objects.MongoUserDict.authorize_pre_read" title="mongo_objects.MongoUserDict.authorize_pre_read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">authorize_pre_read()</span></code></a> is a classmethod that is called once per <code class="xref py py-meth docutils literal notranslate"><span class="pre">find()</span></code>
or <code class="xref py py-meth docutils literal notranslate"><span class="pre">find_one()</span></code> call before any data is read. If the method does not return
<code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="xref py py-exc docutils literal notranslate"><span class="pre">MongoObjectsAuthFailed</span></code> exception is raised.</p>
<p><a class="reference internal" href="#mongo_objects.MongoUserDict.authorize_read" title="mongo_objects.MongoUserDict.authorize_read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">authorize_read()</span></code></a> is called after a document is read but before the data is
returned to the user. The method may inspect to contents of the document to see
if the user is permitted to access this particular document. If <a class="reference internal" href="#mongo_objects.MongoUserDict.authorize_read" title="mongo_objects.MongoUserDict.authorize_read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">authorize_read()</span></code></a> does not
return <code class="docutils literal notranslate"><span class="pre">True</span></code>, the document will be suppressed. For <code class="xref py py-meth docutils literal notranslate"><span class="pre">find_one()</span></code>, if the first
document found is suppressed, <code class="docutils literal notranslate"><span class="pre">None</span></code> will be returned. No additional
(potentially authorized) documents will be evaluated.</p>
</section>
<section id="update">
<h3>Update<a class="headerlink" href="#update" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="#mongo_objects.MongoUserDict.authorize_save" title="mongo_objects.MongoUserDict.authorize_save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">authorize_save()</span></code></a> is called by <code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code> before new or updated documents
are saved. If the method does not return <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="xref py py-exc docutils literal notranslate"><span class="pre">MongoObjectsAuthFailed</span></code>
exception is raised.</p>
</section>
<section id="delete">
<h3>Delete<a class="headerlink" href="#delete" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="#mongo_objects.MongoUserDict.authorize_delete" title="mongo_objects.MongoUserDict.authorize_delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">authorize_delete()</span></code></a> is called by <code class="xref py py-meth docutils literal notranslate"><span class="pre">delete()</span></code> before a document is deleted.
If the method does not return <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="xref py py-exc docutils literal notranslate"><span class="pre">MongoObjectsAuthFailed</span></code> exception is raised.</p>
</section>
</section>
<section id="object-versions">
<h2>Object Versions<a class="headerlink" href="#object-versions" title="Link to this heading">¶</a></h2>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">mongo_objects</span></code> supports an optional document schema versioning system. To enable this
functionality, provide an <em>object_version</em> value when defining the class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Event</span><span class="p">(</span> <span class="n">mongo_objects</span><span class="o">.</span><span class="n">MongoUserDict</span> <span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="o">...</span>          <span class="c1"># provide your pymongo database object here</span>
    <span class="n">collection_name</span> <span class="o">=</span> <span class="s1">&#39;events&#39;</span>
    <span class="n">object_version</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
<p>The current <em>object_version</em> will automatically be added by <code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code> to each document as <em>_objver</em>.</p>
<p>By default <code class="xref py py-meth docutils literal notranslate"><span class="pre">find()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">find_one()</span></code> will then automatically adjust each query
to restrict the results to the current <em>object_version</em>. This guarantees that only objects
at the current object version will be returned. This is equivalent to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="p">{</span>
    <span class="o">...</span> <span class="n">other</span> <span class="n">filters</span> <span class="o">...</span><span class="p">,</span>
    <span class="s1">&#39;_objver&#39;</span> <span class="p">:</span> <span class="n">Event</span><span class="o">.</span><span class="n">object_version</span>
    <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>To manage this functionality, <code class="xref py py-meth docutils literal notranslate"><span class="pre">find()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">find_one()</span></code>
accept an optional <em>object_version</em> parameter with the following meaning:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code> (default): documents will automatically be filtered to the current <em>object_version</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span></code>: no filtering for object version will be performed</p></li>
<li><p>any other value: only documents with this value as the object version will be returned</p></li>
</ul>
<p>Object versioning provides a convenient workflow for migrating database schemas
and protecting the application from inadvertently reading data in an obsolete format.
First increment the <em>object_version</em> of the <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoUserDict</span></code> document subclass,
then loop through all objects at the previous version and perform the migration.</p>
<p>For example, to update the layout of the object defined above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># object_version is now 4</span>
<span class="k">class</span> <span class="nc">Event</span><span class="p">(</span> <span class="n">mongo_objects</span><span class="o">.</span><span class="n">MongoUserDict</span> <span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="o">...</span>          <span class="c1"># provide your pymongo database object here</span>
    <span class="n">collection_name</span> <span class="o">=</span> <span class="s1">&#39;events&#39;</span>
    <span class="n">object_version</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># loop through all objects at version 3</span>
<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">Event</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">object_version</span><span class="o">=</span><span class="mi">3</span> <span class="p">):</span>
    <span class="o">...</span> <span class="n">perform</span> <span class="n">migration</span> <span class="n">steps</span> <span class="o">...</span>

    <span class="c1"># saving the document object automatically updates _objver</span>
    <span class="c1"># to the current value</span>
    <span class="n">event</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="polymorphism">
<h2>Polymorphism<a class="headerlink" href="#polymorphism" title="Link to this heading">¶</a></h2>
<p>Subclass the <code class="xref py py-class docutils literal notranslate"><span class="pre">PolymorphicMongoUserDict</span></code> class to enable <code class="xref py py-mod docutils literal notranslate"><span class="pre">mongo_objects</span></code> support
for polymorphic user document classes. Specifically, from the same MongoDB collection
<code class="xref py py-meth docutils literal notranslate"><span class="pre">find()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">find_one()</span></code>
will return instances of different document classes.</p>
<p>Each polymorphic subclass defines a separate key which
<code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code> adds to the document.
When the document is read back from the database, the key is compared to a list of
potential classes and the correct instance type returned.</p>
<p>Note the strong recommendation to define an empty <em>subclass_map</em> so each set of
polymorphic classes use their own namespace for subclass keys.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mongo_objects</span>

<span class="c1"># create a base class for the collection</span>
<span class="k">class</span> <span class="nc">Event</span><span class="p">(</span> <span class="n">mongo_objects</span><span class="o">.</span><span class="n">PolymorphicMongoUserDict</span> <span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="o">...</span>          <span class="c1"># provide your pymongo database object here</span>
    <span class="n">collection_name</span> <span class="o">=</span> <span class="s1">&#39;events&#39;</span>

    <span class="c1"># Recommended: define an empty subclass_map in the base class</span>
    <span class="c1"># This creates a separate namespace for the polymorphic</span>
    <span class="c1"># subclass keys.</span>
    <span class="c1"># Otherwise, subclasses will share the PolymorphicMongoUserDict</span>
    <span class="c1"># subclass namespace and risk collisions with other subclasses</span>
    <span class="c1"># from other collections.</span>
    <span class="n">subclass_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="o">..</span> <span class="n">your</span> <span class="n">generally</span> <span class="n">useful</span> <span class="n">event</span> <span class="n">methods</span> <span class="o">...</span>

<span class="c1"># now create subclasses for each object variation</span>
<span class="c1"># each subclass requires a unique key</span>
<span class="k">class</span> <span class="nc">OnSiteEvent</span><span class="p">(</span> <span class="n">Event</span> <span class="p">):</span>
    <span class="n">subclass_key</span> <span class="o">=</span> <span class="s1">&#39;onsite&#39;</span>

    <span class="o">..</span> <span class="n">your</span> <span class="n">onsite</span><span class="o">-</span><span class="n">specific</span> <span class="n">event</span> <span class="n">methods</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">OnlineEvent</span><span class="p">(</span> <span class="n">Event</span> <span class="p">):</span>
    <span class="n">subclass_key</span> <span class="o">=</span> <span class="s1">&#39;online&#39;</span>

    <span class="o">..</span> <span class="n">your</span> <span class="n">online</span><span class="o">-</span><span class="n">specific</span> <span class="n">event</span> <span class="n">methods</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">HybridEvent</span><span class="p">(</span> <span class="n">Event</span> <span class="p">):</span>
    <span class="n">subclass_key</span> <span class="o">=</span> <span class="s1">&#39;hybrid&#39;</span>

    <span class="o">..</span> <span class="n">your</span> <span class="n">hybrid</span><span class="o">-</span><span class="n">specific</span> <span class="n">event</span> <span class="n">methods</span> <span class="o">...</span>
</pre></div>
</div>
<section id="creating-documents">
<h3>Creating Documents<a class="headerlink" href="#creating-documents" title="Link to this heading">¶</a></h3>
<p>Create and save the objects using a subclass. <code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code> automatically
adds the appropriate subclass key to the document.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hybrid</span> <span class="o">=</span> <span class="n">HybridEvent</span><span class="p">()</span>
<span class="n">hybrid</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="c1"># save the document ID for later</span>
<span class="n">hybridId</span> <span class="o">=</span> <span class="n">hybrid</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="loading-documents">
<h3>Loading Documents<a class="headerlink" href="#loading-documents" title="Link to this heading">¶</a></h3>
<p>If you load documents using the base class, all available documents
will be returned. The resulting objects will each be an instance
of the correct subclass based on the subclass key.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># event is an instance of HybridEvent</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">load_by_id</span><span class="p">(</span> <span class="n">hybridId</span> <span class="p">)</span>

<span class="c1"># retrieve all events as the correct type</span>
<span class="n">Event</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
</pre></div>
</div>
<p>If you load documents using a subclass, only those documents
of that subclass type will be returned.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Only hybrid event objects will be returned</span>
<span class="n">HybridEvent</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
</pre></div>
</div>
<p>If a document has a missing or invalid subclass key, an instance of
the subclass with a <code class="docutils literal notranslate"><span class="pre">None</span></code> subclass key is returned.
If no such subclass is defined, <code class="xref py py-exc docutils literal notranslate"><span class="pre">MongoObjectsPolymorphicMismatch</span></code> is raised.</p>
</section>
</section>
<section id="proxy-support">
<h2>Proxy Support<a class="headerlink" href="#proxy-support" title="Link to this heading">¶</a></h2>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">MongoUserDict</span></code> seamlessly supports the subdocument proxy objects also
included in this module.</p>
<p><a class="reference internal" href="#mongo_objects.MongoUserDict.get_unique_integer" title="mongo_objects.MongoUserDict.get_unique_integer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_unique_integer()</span></code></a> provides per-document unique integer values.</p>
<p><a class="reference internal" href="#mongo_objects.MongoUserDict.get_unique_key" title="mongo_objects.MongoUserDict.get_unique_key"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_unique_key()</span></code></a> uses these unique integers to create unique string
values suitable for subdocument proxy keys.</p>
<p><a class="reference internal" href="#mongo_objects.MongoUserDict.split_id" title="mongo_objects.MongoUserDict.split_id"><code class="xref py py-meth docutils literal notranslate"><span class="pre">split_id()</span></code></a> separates a full subdocument ID value into its components:
a parent document ObjectId plus one or more proxy keys.</p>
<p>The class method <a class="reference internal" href="#mongo_objects.MongoUserDict.load_proxy_by_id" title="mongo_objects.MongoUserDict.load_proxy_by_id"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_proxy_by_id()</span></code></a> accepts a subdocument ID as
generated by <code class="xref py py-meth docutils literal notranslate"><span class="pre">id()</span></code> and a list of one or more proxy classes.
The parent document is loaded and the proxy objects are
instantiated. See <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoDictProxy</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoListProxy</span></code> for more
details.</p>
<p>For parent documents already loaded in memory, <a class="reference internal" href="#mongo_objects.MongoUserDict.load_proxy_by_local_id" title="mongo_objects.MongoUserDict.load_proxy_by_local_id"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_proxy_by_local_id()</span></code></a> accepts
the proxy ID portion generated by <code class="xref py py-meth docutils literal notranslate"><span class="pre">proxy_id()</span></code> and the related list of proxy classes
to instantiate the requested proxy objects.</p>
</section>
<section id="class-reference">
<h2>Class Reference<a class="headerlink" href="#class-reference" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mongo_objects.</span></span><span class="sig-name descname"><span class="pre">MongoUserDict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readonly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict" title="Link to this definition">¶</a></dt>
<dd><p>Access MongoDB documents through user-defined UserDict subclasses.</p>
<p>User classes must provide <cite>collection_name</cite> and <cite>database</cite> or override
the <a class="reference internal" href="#mongo_objects.MongoUserDict.collection" title="mongo_objects.MongoUserDict.collection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">collection()</span></code></a> method to return the correct pymongo collection object.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.collection_name">
<span class="sig-name descname"><span class="pre">collection_name</span></span><a class="headerlink" href="#mongo_objects.MongoUserDict.collection_name" title="Link to this definition">¶</a></dt>
<dd><p>Required: override with the name of the MongoDB collection
where the documents are stored</p>
<dl class="field-list simple">
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.database">
<span class="sig-name descname"><span class="pre">database</span></span><a class="headerlink" href="#mongo_objects.MongoUserDict.database" title="Link to this definition">¶</a></dt>
<dd><p>Required: override with the pymongo database connection object</p>
<dl class="field-list simple">
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.object_version">
<span class="sig-name descname"><span class="pre">object_version</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#mongo_objects.MongoUserDict.object_version" title="Link to this definition">¶</a></dt>
<dd><p>Optional: If object_version is not``None``, <a class="reference internal" href="#mongo_objects.MongoUserDict.find" title="mongo_objects.MongoUserDict.find"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find()</span></code></a> and <a class="reference internal" href="#mongo_objects.MongoUserDict.find_one" title="mongo_objects.MongoUserDict.find_one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_one()</span></code></a>
by default restrict queries to documents with the current <cite>object_version</cite>.
This enables a type of schema versioning.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.subdoc_key_sep">
<span class="sig-name descname"><span class="pre">subdoc_key_sep</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'g'</span></em><a class="headerlink" href="#mongo_objects.MongoUserDict.subdoc_key_sep" title="Link to this definition">¶</a></dt>
<dd><p>The character sequence used to separate the document ID from proxy subdocument keys.
This may be overridden but it is the user’s responsibility to guarantee that this
sequence will never appear in any ID or subdoc key.
Since the default IDs and subdoc keys are hex, <code class="docutils literal notranslate"><span class="pre">g</span></code> is a safe, default separator</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.autosave_default">
<span class="sig-name descname"><span class="pre">autosave_default</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#mongo_objects.MongoUserDict.autosave_default" title="Link to this definition">¶</a></dt>
<dd><p>The default value if the autosave flag is not set for functions that accept it</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readonly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Initialize the custom UserDict object
flagging readonly objects appropriately.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>MongoObjectsAuthFailed</strong> – if <cite>authorize_init()</cite> has been overridden
and does not return a truthy value</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.authorize_init">
<span class="sig-name descname"><span class="pre">authorize_init</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.authorize_init" title="Link to this definition">¶</a></dt>
<dd><p>Called after the document object is initialized but
before it is returned to the user.</p>
<p>This hook is called when creating a new object and during calls to
<a class="reference internal" href="#mongo_objects.MongoUserDict.find" title="mongo_objects.MongoUserDict.find"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find()</span></code></a> and <a class="reference internal" href="#mongo_objects.MongoUserDict.find_one" title="mongo_objects.MongoUserDict.find_one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_one()</span></code></a>.</p>
<p>Override this method and return <code class="docutils literal notranslate"><span class="pre">False</span></code> to block creating
this document.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Whether creating the current document is authorized (default <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>bool</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.authorize_delete">
<span class="sig-name descname"><span class="pre">authorize_delete</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.authorize_delete" title="Link to this definition">¶</a></dt>
<dd><p>Called before the current document is deleted.</p>
<p>Override this method and return <code class="docutils literal notranslate"><span class="pre">False</span></code> to block deleting
this document.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Whether deleting the current document is authorized (default <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>bool</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.authorize_pre_read">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">authorize_pre_read</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.authorize_pre_read" title="Link to this definition">¶</a></dt>
<dd><p>Called before a read operation is performed.
This is a class method as no data has been read and no
document object has been created.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Whether reading any documents is authorized (default <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>bool</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.authorize_read">
<span class="sig-name descname"><span class="pre">authorize_read</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.authorize_read" title="Link to this definition">¶</a></dt>
<dd><p>Called after a document has been read but before the
data is returned to the user.
If the return value is not truthy, the data will
not be returned.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">find_one()</span></code> only inspects the first document
returned by the underlying <code class="docutils literal notranslate"><span class="pre">pymongo.find_one()</span></code> call. If the
document returned does not pass authorization, no attempt is
made to locate another matching document.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Whether reading the current document is authorized (default <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>bool</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.authorize_save">
<span class="sig-name descname"><span class="pre">authorize_save</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.authorize_save" title="Link to this definition">¶</a></dt>
<dd><p>Called before the current document is saved.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Whether saving the current document is authorized (default <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>bool</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.collection">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">collection</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.collection" title="Link to this definition">¶</a></dt>
<dd><p>Return the <code class="xref py py-class docutils literal notranslate"><span class="pre">pymongo.Collection</span></code> object
from the active database for the named collection</p>
<p>For complex situations users may omit the <em>database</em> and <em>connection_name</em>
attributes when defining the class and instead override this method.</p>
<p>This method must return a <code class="xref py py-class docutils literal notranslate"><span class="pre">pymongo.Collection</span></code> object.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.count_documents">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">count_documents</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_version</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.count_documents" title="Link to this definition">¶</a></dt>
<dd><p>Count the documents matching the filter. Arguments are passed through to
<code class="xref py py-meth docutils literal notranslate"><span class="pre">pymongo.count_documents()</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filter</strong> (<em>dict</em>) – Updated with <em>cls.object_version</em> as appropriate</p></li>
<li><p><strong>object_version</strong> (<code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">False</span></code>, any scalar value) – <p>Only if <em>cls.object_version</em> is not <code class="docutils literal notranslate"><span class="pre">None</span></code>, implement object schema versioning.</p>
<ol class="arabic simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">None</span></code>, update the filter to only return documents with the current <em>cls.object_version</em> value</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">False</span></code>, don’t filter objects by <em>cls.object_version</em></p></li>
<li><p>For any other value, update the filter to only return documents with the given <em>object_version</em></p></li>
</ol>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the count of matching documents</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>MongoObjectsAuthFailed</strong> – if <cite>authorize_pre_read()</cite> has been overridden
and does not return a truthy value</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.delete">
<span class="sig-name descname"><span class="pre">delete</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.delete" title="Link to this definition">¶</a></dt>
<dd><p>Delete the current object.
Remove the id so <a class="reference internal" href="#mongo_objects.MongoUserDict.save" title="mongo_objects.MongoUserDict.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> will know this is a new object if we try to re-save.
Other data values are still available in this dictionary
even after the data is deleted from the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>MongoObjectsAuthFailed</strong> – if <cite>authorize_delete()</cite> has been overridden
and does not return a truthy value</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.find">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">find</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">projection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readonly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_version</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.find" title="Link to this definition">¶</a></dt>
<dd><p>Return matching documents as instances of this class</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filter</strong> (<em>dict</em>) – Updated with <em>cls.object_version</em> as appropriate
and passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">pymongo.find()</span></code></p></li>
<li><p><strong>projection</strong> (<em>dict</em>) – Passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">pymongo.find()</span></code></p></li>
<li><p><strong>readonly</strong> (<code class="docutils literal notranslate"><span class="pre">None</span></code> or <em>bool</em>) – <ol class="arabic simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">None</span></code> and a projection is provided, mark the objects as readonly.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">None</span></code> and no projection is given, consider the objects read-write.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, mark the objects as readonly regardless of the projection.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">False</span></code>, consider the objects read-write regardless of the projection.</p></li>
</ol>
</p></li>
<li><p><strong>object_version</strong> (<code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">False</span></code>, any scalar value) – <p>Only if <em>cls.object_version</em> is not <code class="docutils literal notranslate"><span class="pre">None</span></code>, implement object schema versioning.</p>
<ol class="arabic simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">None</span></code>, update the filter to only return documents with the current <em>cls.object_version</em> value</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">False</span></code>, don’t filter objects by <em>cls.object_version</em></p></li>
<li><p>For any other value, update the filter to only return documents with the given <em>object_version</em></p></li>
</ol>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a generator for instances of the user-defined <a class="reference internal" href="#mongo_objects.MongoUserDict" title="mongo_objects.MongoUserDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">MongoUserDict</span></code></a> subclass</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>MongoObjectsAuthFailed</strong> – if <cite>authorize_pre_read()</cite> has been overridden
and does not return a truthy value</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.find_one">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">find_one</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">projection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readonly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_version</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">no_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.find_one" title="Link to this definition">¶</a></dt>
<dd><p>Return a single matching document as an instance of this class or None</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filter</strong> (<em>dict</em>) – Updated with <em>cls.object_version</em> as appropriate
and passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">pymongo.find()</span></code></p></li>
<li><p><strong>projection</strong> (<em>dict</em>) – Passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">pymongo.find()</span></code></p></li>
<li><p><strong>readonly</strong> (<code class="docutils literal notranslate"><span class="pre">None</span></code> or <em>bool</em>) – as with <a class="reference internal" href="#mongo_objects.MongoUserDict.find" title="mongo_objects.MongoUserDict.find"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MongoUserDict.find()</span></code></a></p></li>
<li><p><strong>object_version</strong> – as with <a class="reference internal" href="#mongo_objects.MongoUserDict.find" title="mongo_objects.MongoUserDict.find"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find()</span></code></a></p></li>
<li><p><strong>no_match</strong> (<code class="docutils literal notranslate"><span class="pre">None</span></code> or any value) – Value to return if no matching document is found</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>no_match</em> value; <code class="docutils literal notranslate"><span class="pre">None</span></code> by default</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>MongoObjectsAuthFailed</strong> – if <cite>authorize_pre_read()</cite> has been overridden
and does not return a truthy value</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.get_unique_integer">
<span class="sig-name descname"><span class="pre">get_unique_integer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">autosave</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.get_unique_integer" title="Link to this definition">¶</a></dt>
<dd><p>Provide the next unique integer for this document.</p>
<p>These integers are convenient for use as keys of subdocuments.
Starts with 1; 0 is reserved for single proxy documents which don’t have a key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>autosave</strong> (<em>bool</em>, <cite>None</cite>) – Should the document be saved after the next
unique integer is issued. <cite>None</cite> uses the class <em>autosave_default</em> value.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The next unique integer for this document</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.get_unique_key">
<span class="sig-name descname"><span class="pre">get_unique_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">autosave</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.get_unique_key" title="Link to this definition">¶</a></dt>
<dd><p>Format the next unique integer as a hexidecimal string</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>autosave</strong> (<em>bool</em>, <cite>None</cite>) – passed to <a class="reference internal" href="#mongo_objects.MongoUserDict.get_unique_integer" title="mongo_objects.MongoUserDict.get_unique_integer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_unique_integer()</span></code></a></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The lowercase hexidecimal string representing the
next unique integer for this document.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.id">
<span class="sig-name descname"><span class="pre">id</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.id" title="Link to this definition">¶</a></dt>
<dd><p>Convert this document’s ObjectId to a string</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The document ObjectId</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>KeyError</strong> – if the document has not yet been saved
and has not been assigned an ObjectId</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.load_by_id">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_by_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc_id</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.load_by_id" title="Link to this definition">¶</a></dt>
<dd><p>Locate a document by its ObjectId</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>doc_id</strong> (<cite>str</cite> or <cite>bson.ObjectId</cite>) – the ObjectId for the desired document</p></li>
<li><p><strong>kwargs</strong> – passed to <a class="reference internal" href="#mongo_objects.MongoUserDict.find_one" title="mongo_objects.MongoUserDict.find_one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_one()</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an instance of the current class or None
if not found. Invalid ObjectIds return None.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.load_proxy_by_id">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load_proxy_by_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">id</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readonly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.load_proxy_by_id" title="Link to this definition">¶</a></dt>
<dd><p>Based on a full subdocument ID string and a list of classes,
load the Mongo parent document, create any intermediate proxies
and return the requested proxy object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>id</strong> (<em>str</em>) – a full subdocument ID string separated by <cite>cls.subdoc_key_sep</cite>.
It includes the ObjectId of the top-level MongoDB document and
one or more subdocument keys as generated by <a class="reference internal" href="#mongo_objects.MongoUserDict.id" title="mongo_objects.MongoUserDict.id"><code class="xref py py-meth docutils literal notranslate"><span class="pre">id()</span></code></a>.</p></li>
<li><p><strong>args</strong> – one or more user-defined proxy classes in descending order,
one per subdocument key. The top-level parent <a class="reference internal" href="#mongo_objects.MongoUserDict" title="mongo_objects.MongoUserDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">MongoUserDict</span></code></a>
subclass is not included.</p></li>
<li><p><strong>readonly</strong> (<em>bool</em>) – passed to <a class="reference internal" href="#mongo_objects.MongoUserDict.load_by_id" title="mongo_objects.MongoUserDict.load_by_id"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_by_id()</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an instance of the final, rightmost proxy subdocument class
from <em>args</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.load_proxy_by_local_id">
<span class="sig-name descname"><span class="pre">load_proxy_by_local_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">id</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readonly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.load_proxy_by_local_id" title="Link to this definition">¶</a></dt>
<dd><p>Based on a local subdocument ID string and a list of classes,
create any intermediate proxies within the current document
and return the requested proxy object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>id</strong> (<em>str</em>) – a local subdocument ID string generated by
<a class="reference internal" href="#mongo_objects.MongoUserDict.proxy_id" title="mongo_objects.MongoUserDict.proxy_id"><code class="xref py py-meth docutils literal notranslate"><span class="pre">proxy_id()</span></code></a> containing one or more subdocument keys
separated by <cite>cls.subdoc_key_sep</cite>.</p></li>
<li><p><strong>args</strong> – one or more user-defined proxy classes in descending order,
one per subdocument key.</p></li>
<li><p><strong>readonly</strong> (<em>bool</em>) – passed to <a class="reference internal" href="#mongo_objects.MongoUserDict.find_one" title="mongo_objects.MongoUserDict.find_one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_one()</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an instance of the final, rightmost proxy subdocument class
from <em>args</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.proxy_id">
<span class="sig-name descname"><span class="pre">proxy_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_parent_doc_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.proxy_id" title="Link to this definition">¶</a></dt>
<dd><p>Assemble a list of proxy IDs into a single string</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>include_parent_doc_id</strong> (<em>bool</em>) – whether to include the
parent document ID in the resulting ID string</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>One or more proxy IDs separated by <cite>subdoc_key_sep</cite></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.save" title="Link to this definition">¶</a></dt>
<dd><p>Intelligent wrapper to insert or replace a document</p>
<p>A current <cite>_updated</cite> timestamp is added to all documents.</p>
<p>The first time a document is saved, a <cite>_created</cite> timestamp is added as well.</p>
<p>If the class defines a non-<code class="docutils literal notranslate"><span class="pre">None</span></code> <cite>object_version</cite>, this added as <cite>_objver</cite> to
the document as well.</p>
<ol class="arabic simple">
<li><p>Documents without an <cite>_id</cite> are inserted into the database; MongoDB will assign the ObjectId</p></li>
<li><p>If <cite>force</cite> is set, document will be saved regardless of update time or even if it exists.
This is useful for upserting documents from another database.</p></li>
<li><p>Otherwise, only a database document whose <cite>_id</cite> and <cite>_updated</cite> timestamp
match this object will be replaced.
This protects against overwriting documents that have been updated elsewhere.</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>force</strong> (<em>bool</em>, optional) – if <code class="docutils literal notranslate"><span class="pre">True</span></code>, upsert the new document regardless of its <cite>_updated</cite> timestamp</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>MongoObjectsAuthFailed</strong> – if <cite>authorize_save()</cite> has been overridden
and does not return a truthy value</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.split_id">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">split_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">subdoc_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.split_id" title="Link to this definition">¶</a></dt>
<dd><p>Split a subdocument ID into its component document ID and one or more subdocument keys.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>subdoc_id</strong> (<em>str</em>) – a full subdocument ID starting with a document ObjectId
followed by one or more subdocument proxy keys separated by <cite>cls.subdoc_key_sep</cite>.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list. The first element of the list is the document ObjectId.
The remaining elements in the list are subdocument proxy keys.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.MongoUserDict.utcnow">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">utcnow</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.MongoUserDict.utcnow" title="Link to this definition">¶</a></dt>
<dd><p>MongoDB stores milliseconds, not microseconds.
Drop microseconds from the standard utcnow() so comparisons can be made with database times.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The current time with microseconds set to 0.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>naive <code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.datetime</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="polymorphic-class-reference">
<h2>Polymorphic Class Reference<a class="headerlink" href="#polymorphic-class-reference" title="Link to this heading">¶</a></h2>
<p>Polymorphic proxies are supported by <a class="reference internal" href="#mongo_objects.PolymorphicMongoUserDict" title="mongo_objects.PolymorphicMongoUserDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">PolymorphicMongoUserDict</span></code></a>. All the
attributes and methods of <a class="reference internal" href="#mongo_objects.MongoUserDict" title="mongo_objects.MongoUserDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">MongoUserDict</span></code></a> are supported with the following
overrides.</p>
<dl class="py class">
<dt class="sig sig-object py" id="mongo_objects.PolymorphicMongoUserDict">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mongo_objects.</span></span><span class="sig-name descname"><span class="pre">PolymorphicMongoUserDict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readonly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.PolymorphicMongoUserDict" title="Link to this definition">¶</a></dt>
<dd><p>Like MongoUserDict but supports polymorphic document objects within the same collection.</p>
<p>Each subclass needs to define a unique subclass_key</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="mongo_objects.PolymorphicMongoUserDict.subclass_map">
<span class="sig-name descname"><span class="pre">subclass_map</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{}</span></em><a class="headerlink" href="#mongo_objects.PolymorphicMongoUserDict.subclass_map" title="Link to this definition">¶</a></dt>
<dd><p>Map subclass_keys to subclasses</p>
<p>Strongly recommended: Override this with an empty dictionary
in the base class of your subclass tree to create a separate
namespace</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mongo_objects.PolymorphicMongoUserDict.subclass_key">
<span class="sig-name descname"><span class="pre">subclass_key</span></span><a class="headerlink" href="#mongo_objects.PolymorphicMongoUserDict.subclass_key" title="Link to this definition">¶</a></dt>
<dd><p>Must be unique for each subclass.</p>
<p>One class (usually the base class of the subclass tree)
may leave this as None. That subclass will be treated as the
default subclass for any documents with a missing or unknown
subclass key.</p>
<dl class="field-list simple">
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mongo_objects.PolymorphicMongoUserDict.subclass_key_name">
<span class="sig-name descname"><span class="pre">subclass_key_name</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'_sckey'</span></em><a class="headerlink" href="#mongo_objects.PolymorphicMongoUserDict.subclass_key_name" title="Link to this definition">¶</a></dt>
<dd><p>Name of internal key added to each document
to record the subclass_key</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.PolymorphicMongoUserDict.find">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">find</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">projection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readonly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_version</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.PolymorphicMongoUserDict.find" title="Link to this definition">¶</a></dt>
<dd><p>Return matching documents as appropriate subclass instances</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filter</strong> (<em>dict</em>) – Updated with <em>cls.object_version</em> as appropriate
and passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">pymongo.find()</span></code></p></li>
<li><p><strong>projection</strong> (<em>dict</em>) – Passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">pymongo.find()</span></code></p></li>
<li><p><strong>readonly</strong> (<code class="docutils literal notranslate"><span class="pre">None</span></code> or <em>bool</em>) – as with <a class="reference internal" href="#mongo_objects.MongoUserDict.find" title="mongo_objects.MongoUserDict.find"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MongoUserDict.find()</span></code></a></p></li>
<li><p><strong>object_version</strong> – as with <a class="reference internal" href="#mongo_objects.MongoUserDict.find" title="mongo_objects.MongoUserDict.find"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MongoUserDict.find()</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a generator for instances of the user-defined <a class="reference internal" href="#mongo_objects.PolymorphicMongoUserDict" title="mongo_objects.PolymorphicMongoUserDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">PolymorphicMongoUserDict</span></code></a> subclasses,
each correct for the document being returned</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>MongoObjectsAuthFailed</strong> – if <cite>authorize_pre_read()</cite> has been overridden
and does not return a truthy value</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.PolymorphicMongoUserDict.find_one">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">find_one</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">projection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readonly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_version</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">no_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.PolymorphicMongoUserDict.find_one" title="Link to this definition">¶</a></dt>
<dd><p>Return a single matching document as the appropriate subclass or None</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filter</strong> (<em>dict</em>) – Updated with <em>cls.object_version</em> as appropriate
and passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">pymongo.find()</span></code></p></li>
<li><p><strong>projection</strong> (<em>dict</em>) – Passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">pymongo.find()</span></code></p></li>
<li><p><strong>readonly</strong> (<code class="docutils literal notranslate"><span class="pre">None</span></code> or <em>bool</em>) – as with <a class="reference internal" href="#mongo_objects.MongoUserDict.find" title="mongo_objects.MongoUserDict.find"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MongoUserDict.find()</span></code></a></p></li>
<li><p><strong>object_version</strong> – as with <a class="reference internal" href="#mongo_objects.MongoUserDict.find" title="mongo_objects.MongoUserDict.find"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MongoUserDict.find()</span></code></a></p></li>
<li><p><strong>no_match</strong> – as with <a class="reference internal" href="#mongo_objects.MongoUserDict.find_one" title="mongo_objects.MongoUserDict.find_one"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MongoUserDict.find_one()</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an instance of the user-defined <a class="reference internal" href="#mongo_objects.PolymorphicMongoUserDict" title="mongo_objects.PolymorphicMongoUserDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">PolymorphicMongoUserDict</span></code></a> subclass
correct for this document</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>MongoObjectsAuthFailed</strong> – if <a class="reference internal" href="#mongo_objects.MongoUserDict.authorize_pre_read" title="mongo_objects.MongoUserDict.authorize_pre_read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">authorize_pre_read()</span></code></a> has been overridden
and does not return a truthy value</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.PolymorphicMongoUserDict.get_subclass_by_key">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_subclass_by_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">subclass_key</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.PolymorphicMongoUserDict.get_subclass_by_key" title="Link to this definition">¶</a></dt>
<dd><p>Look up a subclass in the subclass_map by its subclass_key.
If the subclass can’t be located, return the class with
subclass_key <code class="docutils literal notranslate"><span class="pre">None</span></code>.
If there is no such class, raise an exception.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>subclass_key</strong> (<em>str</em>) – subclass key</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>polymorphic document subclass</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>MongoObjectsPolymorphicMismatch</strong> – if the subclass key
isn’t in the subclass map and no subclass with
a <code class="docutils literal notranslate"><span class="pre">None</span></code> key was registered as the default.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.PolymorphicMongoUserDict.get_subclass_from_doc">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_subclass_from_doc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.PolymorphicMongoUserDict.get_subclass_from_doc" title="Link to this definition">¶</a></dt>
<dd><p>Return the correct subclass to represent this document.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>doc</strong> (<em>dict</em>) – document dictionary</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>polymorphic document subclass</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>MongoObjectsPolymorphicMismatch</strong> – if the document
doesn’t have a subclass key, the subclass key
isn’t in the subclass map and no subclass with
a <code class="docutils literal notranslate"><span class="pre">None</span></code> key was registered as the default.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mongo_objects.PolymorphicMongoUserDict.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mongo_objects.PolymorphicMongoUserDict.save" title="Link to this definition">¶</a></dt>
<dd><p>Add the <cite>subclass_key</cite> to the document and call <a class="reference internal" href="#mongo_objects.MongoUserDict.save" title="mongo_objects.MongoUserDict.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MongoUserDict.save()</span></code></a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>kwargs</strong> – passed to <a class="reference internal" href="#mongo_objects.MongoUserDict.save" title="mongo_objects.MongoUserDict.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MongoUserDict.save()</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">mongo_objects</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample.html">Sample Application</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">MongoUserDict</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crud-operations">CRUD Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#read-only-documents">Read-Only Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#document-ids">Document IDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#authorization">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#object-versions">Object Versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#polymorphism">Polymorphism</a></li>
<li class="toctree-l2"><a class="reference internal" href="#proxy-support">Proxy Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#class-reference">Class Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="#polymorphic-class-reference">Polymorphic Class Reference</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="proxy_overview.html">Proxy Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="MongoDictProxy.html">MongoDictProxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="MongoListProxy.html">MongoListProxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="MongoSingleProxy.html">MongoSingleProxy</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="sample.html" title="previous chapter">Sample Application</a></li>
      <li>Next: <a href="proxy_overview.html" title="next chapter">Proxy Overview</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Jonathan Lindstrom.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/MongoUserDict.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>