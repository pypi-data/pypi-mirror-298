<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Proxy Overview &#8212; mongo_objects 1.2.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=36f53d34"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MongoDictProxy" href="MongoDictProxy.html" />
    <link rel="prev" title="MongoUserDict" href="MongoUserDict.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="proxy-overview">
<h1>Proxy Overview<a class="headerlink" href="#proxy-overview" title="Link to this heading">¶</a></h1>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">mongo_objects</span></code> provides proxy classes to manage MongoDB subdocuments
(sub-dictionaries) as their own custom classes.
Proxying offers several advantages:</p>
<ul class="simple">
<li><p>Once the parent document is loaded, no additional database access is required
to access the subdocuments</p></li>
<li><p>No data is copied from parent to proxy, so the parent document remains
the single source of truth</p></li>
<li><p>All proxies built from the same parent document object refer to the same
in-memory data reducing the risk of duplicate, inconsistent objects.</p></li>
<li><p>Proxy subdocument classes organize the methods required for the subdocument
separate from methods for the parent document itself</p></li>
</ul>
<p>Note that <em>parent</em> here refers to the top-level MongoDB document that may contain
various levels of subdocuments. No object oriented inheritance between the
top-level document and subdocument classes is implied.</p>
<section id="proxy-data-structures">
<h2>Proxy Data Structures<a class="headerlink" href="#proxy-data-structures" title="Link to this heading">¶</a></h2>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">mongo_objects</span></code> supports three different types of proxies. See the specific
class documentation for usage details.</p>
<ul>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">MongoDictProxy</span></code> uses a <strong>dictionary</strong> to contain a group of related subdocuments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>                     <span class="c1"># parent document</span>
    <span class="p">{</span>                 <span class="c1"># container is a dictionary</span>
        <span class="p">{</span> <span class="o">...</span> <span class="p">},</span>      <span class="c1"># proxies point to individual subdocuments</span>
        <span class="p">{</span> <span class="o">...</span> <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">MongoListProxy</span></code> uses a <strong>list</strong> to contain a group of related subdocuments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>                     <span class="c1"># parent document</span>
    <span class="p">[</span>                 <span class="c1"># container is a list</span>
        <span class="p">{</span> <span class="o">...</span> <span class="p">},</span>      <span class="c1"># proxies point to individual subdocuments</span>
        <span class="p">{</span> <span class="o">...</span> <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">MongoSingleProxy</span></code> references a <strong>single</strong> subdocument as its own class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>                     <span class="c1"># parent document</span>
                      <span class="c1"># no container; the subdocument is a direct</span>
                      <span class="c1"># member of the parent document</span>
    <span class="p">{</span> <span class="o">...</span> <span class="p">},</span>          <span class="c1"># proxy points to a single subdocument</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<p>You can create as many proxies as needed to describe the data structure of
your document. Proxies can also be nested to access subdocuments within
subdocuments.</p>
<p>The same proxy may be used as a subdocument in multiple document collections,
for example, a <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoSingleProxy</span></code> <em>Address</em> subdocument might used in the
Customer, Vendor and Employee collections.</p>
</section>
<section id="crud-operations">
<h2>CRUD Operations<a class="headerlink" href="#crud-operations" title="Link to this heading">¶</a></h2>
<p>All <code class="xref py py-mod docutils literal notranslate"><span class="pre">mongo_objects</span></code> proxy classes support the full set of CRUD operations.</p>
<p>We’ll use the following classes from the sample code to demonstrate
CRUD operations on all proxy types.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subdocument classes are typically defined first</span>
<span class="c1"># so the parent document class can reference them</span>
<span class="k">class</span> <span class="nc">TicketType</span><span class="p">(</span> <span class="n">mongo_objects</span><span class="o">.</span><span class="n">MongoDictProxy</span> <span class="p">):</span>
    <span class="n">container_name</span> <span class="o">=</span> <span class="s1">&#39;ticket_types&#39;</span>

<span class="k">class</span> <span class="nc">Ticket</span><span class="p">(</span> <span class="n">mongo_objects</span><span class="o">.</span><span class="n">MongoListProxy</span> <span class="p">):</span>
    <span class="n">container_name</span> <span class="o">=</span> <span class="s1">&#39;tickets&#39;</span>

<span class="k">class</span> <span class="nc">Venue</span><span class="p">(</span> <span class="n">mongo_objects</span><span class="o">.</span><span class="n">MongoSingleProxy</span> <span class="p">):</span>
    <span class="n">container_name</span> <span class="o">=</span> <span class="s1">&#39;venue&#39;</span>

<span class="k">class</span> <span class="nc">Seat</span><span class="p">(</span> <span class="n">mongo_objects</span><span class="o">.</span><span class="n">MongoListProxy</span> <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a list of seats within the venue subdocument&quot;&quot;&quot;</span>
    <span class="n">container_name</span> <span class="o">=</span> <span class="s1">&#39;seats&#39;</span>


<span class="c1"># The parent document class</span>
<span class="k">class</span> <span class="nc">Events</span><span class="p">(</span> <span class="n">mongo_objects</span><span class="o">.</span><span class="n">MongoUserDict</span> <span class="p">):</span>
    <span class="n">collection_name</span> <span class="o">=</span> <span class="s1">&#39;events&#39;</span>
    <span class="n">database</span> <span class="o">=</span> <span class="o">...</span> <span class="n">pymongo</span> <span class="n">database</span> <span class="n">connection</span> <span class="nb">object</span> <span class="o">...</span>
</pre></div>
</div>
<p>Since the subdocument data is proxied from the parent document,
the parent document object must exist first before any proxies can be
used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a new event</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>
</pre></div>
</div>
<section id="create">
<h3>Create<a class="headerlink" href="#create" title="Link to this heading">¶</a></h3>
<p>Now we can create new subdocuments within the parent document.
Unique keys will be auto-assigned to distinguish each
<code class="xref py py-class docutils literal notranslate"><span class="pre">MongoDictProxy</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoListProxy</span></code>
subdocument. <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoSingleProxy</span></code> doesn’t need unique keys.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tt</span> <span class="o">=</span> <span class="n">TicketTypes</span><span class="o">.</span><span class="n">create</span><span class="p">(</span> <span class="n">event</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;VIP Ticket&#39;</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span> <span class="p">)</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">Ticket</span><span class="o">.</span><span class="n">create</span><span class="p">(</span> <span class="n">event</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;Fred&#39;</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span> <span class="p">)</span>
<span class="n">venue</span> <span class="o">=</span> <span class="n">Venue</span><span class="o">.</span><span class="n">create</span><span class="p">(</span> <span class="n">event</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;Grand Auditorium&#39;</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span> <span class="p">)</span>

<span class="c1"># as a second-level proxy, seats are created</span>
<span class="c1"># using the venue object as the parent</span>
<span class="n">seat</span> <span class="o">=</span> <span class="n">Seat</span><span class="o">.</span><span class="n">create</span><span class="p">(</span> <span class="n">venue</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;position&#39;</span> <span class="p">:</span> <span class="s1">&#39;A1&#39;</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>Since the proxied subdocument data only exists within the parent, saving
a subdocument actually saves the entire parent document. These four
method calls are identical and save the <em>event</em> object created above.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tt</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">venue</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">seat</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="read">
<h3>Read<a class="headerlink" href="#read" title="Link to this heading">¶</a></h3>
<p>If we know the proxy key, we can initialize an instance directly from the parent.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">freds_ticket</span> <span class="o">=</span> <span class="n">Ticket</span><span class="p">(</span> <span class="n">event</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_proxy()</span></code> accomplishes the same thing. For polymorphic subdocument classes
you must use <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_proxy()</span></code> to create the correct subclass type.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sallys_ticket</span> <span class="o">=</span> <span class="n">Ticket</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">(</span> <span class="n">event</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_proxies()</span></code> allows us to loop through all the proxies in a container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">tickets</span> <span class="ow">in</span> <span class="n">Ticket</span><span class="o">.</span><span class="n">get_proxies</span><span class="p">(</span> <span class="n">event</span> <span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="update">
<h3>Update<a class="headerlink" href="#update" title="Link to this heading">¶</a></h3>
<p>Use any standard method of modifying a dictionary to update the data in a proxy
object. Call the <code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code> method to save the subdocument. This in turn
calls <code class="xref py py-meth docutils literal notranslate"><span class="pre">MongoUserDict.save()</span></code> to save the parent document to the database.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># updating the VIP Ticket subdocument created above</span>
<span class="n">tt</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Includes wider seats and a free plushie&quot;</span>
<span class="n">tt</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span> <span class="s1">&#39;cost&#39;</span> <span class="p">:</span> <span class="mi">200</span> <span class="p">}</span> <span class="p">)</span>
<span class="n">tt</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="s1">&#39;currency&#39;</span><span class="p">,</span> <span class="s1">&#39;eur&#39;</span> <span class="p">)</span>

<span class="n">tt</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="delete">
<h3>Delete<a class="headerlink" href="#delete" title="Link to this heading">¶</a></h3>
<p>Use <code class="xref py py-meth docutils literal notranslate"><span class="pre">delete()</span></code> to delete a subdocument. By default the parent document
is saved so the database is updated immediately.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">freds_ticket</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">¶</a></h2>
<section id="passing-objects">
<h3>Passing Objects<a class="headerlink" href="#passing-objects" title="Link to this heading">¶</a></h3>
<p>Each proxy object contains a reference to its immediate parent in the <code class="xref py py-attr docutils literal notranslate"><span class="pre">parent</span></code>
attribute. The top-level MongoDB document is referenced in the <code class="xref py py-attr docutils literal notranslate"><span class="pre">ultimate_parent</span></code>
attribute.</p>
<p>Instead of passing multiple objects between functions, pass the lowest level proxy object
and determine the others based on that. In the example classes above, iterate the
ticket types for the event from a seat object with the following code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># seat.ultimate_parent is an Event object</span>
<span class="n">TicketTypes</span><span class="o">.</span><span class="n">get_proxies</span><span class="p">(</span> <span class="n">seat</span><span class="o">.</span><span class="n">ultimate_parent</span> <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="subdocument-ids">
<h3>Subdocument IDs<a class="headerlink" href="#subdocument-ids" title="Link to this heading">¶</a></h3>
<p>Each proxy object has a unique identifier generated by <code class="xref py py-meth docutils literal notranslate"><span class="pre">id()</span></code>. This ID is simply
the parent document ObjectId and the proxy key joined with <code class="docutils literal notranslate"><span class="pre">g</span></code>. For multi-level
proxies, the ID for each proxy is appended in order from top-level proxy on down.</p>
<p>This ID can be passed to the class method <code class="xref py py-meth docutils literal notranslate"><span class="pre">load_proxy_by_id()</span></code> to load the
parent document and return the proxy object.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ticket_type_id</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>

<span class="n">vip_tickets</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">load_proxy_by_id</span><span class="p">(</span> <span class="n">ticket_type_id</span><span class="p">,</span> <span class="n">TicketType</span> <span class="p">)</span>
</pre></div>
</div>
<p>It is common to add convenience classmethods to the parent
document <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoUserDict</span></code> class that wrap
<code class="xref py py-meth docutils literal notranslate"><span class="pre">load_proxy_by_id()</span></code> for specific subdocuments. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Event</span><span class="p">(</span> <span class="n">mongo_objects</span><span class="o">.</span><span class="n">MongoUserDict</span> <span class="p">):</span>

    <span class="o">...</span> <span class="n">other</span> <span class="n">configuration</span> <span class="ow">and</span> <span class="n">code</span> <span class="o">...</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_ticket_type_by_id</span><span class="p">(</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">ticket_type_id</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Conveniently load ticket types from an ID&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">load_proxy_by_id</span><span class="p">(</span> <span class="n">ticket_type_id</span><span class="p">,</span> <span class="n">TicketType</span> <span class="p">)</span>
</pre></div>
</div>
<p>It is safe to nest multiple levels of proxies. Provide the full set of subdocument
classes to <a class="reference internal" href="MongoUserDict.html#mongo_objects.MongoUserDict.load_proxy_by_id" title="mongo_objects.MongoUserDict.load_proxy_by_id"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_proxy_by_id()</span></code></a> starting with the topmost proxy. We can
load a seat proxy with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this will return an instance of &quot;Seat&quot;</span>
<span class="n">seat</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">load_proxy_by_id</span><span class="p">(</span>
    <span class="n">seatId</span><span class="p">,</span>
    <span class="n">Venue</span><span class="p">,</span>   <span class="c1"># start with the top-level proxy class</span>
    <span class="n">Seat</span>     <span class="c1"># end with the lowest-level proxy class</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>There is also a parallel set of methods <code class="xref py py-meth docutils literal notranslate"><span class="pre">proxy_id()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">load_proxy_by_local_id()</span></code>
that omit the parent document ObjectId. These “local IDs” server as convenient
subdocument foreign keys within the same document.</p>
<p>Note that for a top-level proxy, the result of <code class="xref py py-meth docutils literal notranslate"><span class="pre">proxy_id()</span></code> is the proxy key.
<code class="xref py py-meth docutils literal notranslate"><span class="pre">get_proxy()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">load_proxy_by_local_id()</span></code> then perform the same function.
Assuming <em>ticketId</em> is the ticket proxy key, the following two lines of code are identical:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ticket</span> <span class="o">=</span> <span class="n">Ticket</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">(</span> <span class="n">event</span><span class="p">,</span> <span class="n">ticketId</span> <span class="p">)</span>
<span class="n">ticket</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">load_proxy_by_local_id</span><span class="p">(</span> <span class="n">ticketId</span><span class="p">,</span> <span class="n">Ticket</span> <span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="polymorphism">
<h2>Polymorphism<a class="headerlink" href="#polymorphism" title="Link to this heading">¶</a></h2>
<p>Each proxy class has a polymorphic variant that supports returning separate
subdocument classes from the same container.</p>
<p>Polymorphism is entirely mix-and-match. A polymorphic parent document may have
non-polymorphic proxies and a non-polymorphic parent document may include
polymorphic proxies.</p>
<section id="subclass-keys">
<h3>Subclass Keys<a class="headerlink" href="#subclass-keys" title="Link to this heading">¶</a></h3>
<p>Each polymorphic subdocument subclass must define a unique proxy subclass key
which <code class="xref py py-meth docutils literal notranslate"><span class="pre">create()</span></code> adds to the subdocument. <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_proxy()</span></code> inspects
the subclass key and instantiates the correct subclass type.</p>
<p>As a special case, one subclass may define a <code class="docutils literal notranslate"><span class="pre">None</span></code> key. Usually this is the
base class for the rest of the subclass tree. Any subdocuments with a missing
or invalid proxy subclass key will be instantiated as this default class.</p>
<p>Note the strong recommendation to define an empty <em>proxy_subclass_map</em> so each set of
polymorphic classes use their own namespace for proxy subclass keys.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a base proxy class for the container</span>
<span class="k">class</span> <span class="nc">Ticket</span><span class="p">(</span> <span class="n">mongo_objects</span><span class="o">.</span><span class="n">PolymorphicMongoListProxy</span> <span class="p">):</span>
    <span class="n">container_name</span> <span class="o">=</span> <span class="s1">&#39;tickets&#39;</span>

    <span class="c1"># Recommended: define an empty proxy_subclass_map in the base class</span>
    <span class="c1"># This creates a separate namespace for the polymorphic</span>
    <span class="c1"># proxy subclass keys.</span>
    <span class="c1"># Otherwise, subclasses will share the base proxy subclass namespace</span>
    <span class="c1"># from PolymorphicMongoBaseProxy and risk name collisions with other proxies.</span>
    <span class="n">proxy_subclass_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="o">..</span> <span class="n">your</span> <span class="n">generally</span> <span class="n">useful</span> <span class="n">ticket</span> <span class="n">methods</span> <span class="o">...</span>

<span class="c1"># now create subclasses for each object variation</span>
<span class="c1"># each subclass requires a unique key</span>
<span class="k">class</span> <span class="nc">OneWayTicket</span><span class="p">(</span> <span class="n">Ticket</span> <span class="p">):</span>
    <span class="n">proxy_subclass_key</span> <span class="o">=</span> <span class="s1">&#39;single&#39;</span>

    <span class="o">..</span> <span class="n">your</span> <span class="n">one</span><span class="o">-</span><span class="n">way</span> <span class="n">specific</span> <span class="n">ticket</span> <span class="n">methods</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">RoundTripTicket</span><span class="p">(</span> <span class="n">Ticket</span> <span class="p">):</span>
    <span class="n">proxy_subclass_key</span> <span class="o">=</span> <span class="s1">&#39;return&#39;</span>

    <span class="o">..</span> <span class="n">your</span> <span class="nb">round</span><span class="o">-</span><span class="n">trip</span> <span class="n">specific</span> <span class="n">ticket</span> <span class="n">methods</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">MultiCityTicket</span><span class="p">(</span> <span class="n">Ticket</span> <span class="p">):</span>
    <span class="n">proxy_class_key</span> <span class="o">=</span> <span class="s1">&#39;multi&#39;</span>

    <span class="o">..</span> <span class="n">your</span> <span class="n">multi</span><span class="o">-</span><span class="n">city</span> <span class="n">specific</span> <span class="n">ticket</span> <span class="n">methods</span> <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="creating-subdocuments">
<h3>Creating Subdocuments<a class="headerlink" href="#creating-subdocuments" title="Link to this heading">¶</a></h3>
<p>Create and save the objects using a subclass.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">multi</span> <span class="o">=</span> <span class="n">MultiCityTicket</span><span class="p">(</span> <span class="n">event</span> <span class="p">)</span>
<span class="n">multi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c1"># save the subdocument ID for later</span>
<span class="n">ticketId</span> <span class="o">=</span> <span class="n">multi</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="loading-subdocuments">
<h3>Loading Subdocuments<a class="headerlink" href="#loading-subdocuments" title="Link to this heading">¶</a></h3>
<p>If you load subdocuments using the base class, all available documents
will be returned. The resulting objects will each be an instance
of the correct subclass based on the proxy subclass key.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># multi_again is an instance of MultiCityTicket</span>
<span class="n">multi_again</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">load_proxy_by_id</span><span class="p">(</span> <span class="n">ticketId</span><span class="p">,</span> <span class="n">Ticket</span> <span class="p">)</span>

<span class="c1"># retrieve all proxies as the correct type</span>
<span class="n">Ticket</span><span class="o">.</span><span class="n">get_proxies</span><span class="p">(</span> <span class="n">event</span> <span class="p">)</span>
</pre></div>
</div>
<p>If you load subdocuments using a subclass, only those documents
of that subclass type will be returned.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Only retrieve multi-city ticket subdocuments</span>
<span class="n">MultiCityTicket</span><span class="o">.</span><span class="n">get_proxies</span><span class="p">(</span> <span class="n">event</span> <span class="p">)</span>
</pre></div>
</div>
<p>If a subdocument has a missing or invalid proxy subclass key, an instance of
the subclass with a <code class="docutils literal notranslate"><span class="pre">None</span></code> proxy subclass key is returned.
If no such subclass is defined, <code class="xref py py-exc docutils literal notranslate"><span class="pre">MongoObjectsPolymorphicMismatch</span></code> is raised.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">mongo_objects</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample.html">Sample Application</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="MongoUserDict.html">MongoUserDict</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Proxy Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#proxy-data-structures">Proxy Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crud-operations">CRUD Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="#polymorphism">Polymorphism</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="MongoDictProxy.html">MongoDictProxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="MongoListProxy.html">MongoListProxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="MongoSingleProxy.html">MongoSingleProxy</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="MongoUserDict.html" title="previous chapter">MongoUserDict</a></li>
      <li>Next: <a href="MongoDictProxy.html" title="next chapter">MongoDictProxy</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Jonathan Lindstrom.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/proxy_overview.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>