import{defineComponent as S,openBlock as d,createElementBlock as h,Fragment as q,createVNode as l,mergeProps as ne,createElementVNode as e,toDisplayString as o,unref as t,renderSlot as L,normalizeClass as Q,ref as k,onMounted as Z,createBlock as C,withCtx as m,createCommentVNode as A,computed as B,createTextVNode as w,renderList as j,readonly as ze,watchEffect as X,resolveComponent as F,watchPostEffect as Ae,Teleport as te,withModifiers as ee,createApp as Ce}from"vue";import{E as se,y as M,C as U,bn as Se,I as E,_ as W,b as me,bo as De,e as pe,ah as x,z as K,K as H,D as Re,G as I,b7 as re,bp as Me,bq as Te,aq as be,bb as qe,br as Pe,bs as Be,am as Oe,L as le,ac as Ie,bt as Le,aO as ie,b2 as Fe,bu as Ue,bv as ge,W as N,a6 as Ee,aL as ve,bw as Ve,ar as Ne,Y as oe,a0 as je,bx as He,by as We,aF as Ye,bz as Ge,bA as ce,bB as Je,bC as Ke,bD as Qe,bE as Ze,bF as Xe,bG as xe,b6 as et,bH as tt,bI as st,a as de,bJ as ot,bK as at,bL as nt,bM as rt,a7 as lt,bN as it,bO as dt,bP as he,bd as ut,bg as ae,aN as ct,bh as ft,bi as _t,bj as mt,bQ as pt,bR as bt,bk as gt,bl as vt,bm as ht}from"./sentry.5.2.3.dev31053.js";import"vue-content-loader";import"./_commonjsHelpers.5.2.3.dev31053.js";function zn(){import.meta.url,import("_").catch(()=>1);async function*c(){}}const yt={class:"fr-ml-1v fr-text--bold"},$t=S({__name:"AvatarWithName",props:{user:{},size:{default:12}},setup(c){return(s,a)=>(d(),h(q,null,[l(se,ne(s.$attrs,{user:s.user,size:s.size,rounded:!0}),null,16,["user","size"]),e("span",yt,o(s.user.first_name)+" "+o(s.user.last_name),1)],64))}}),wt=["aria-label"],kt={class:"fr-breadcrumb__list"},Y={__name:"Breadcrumb",setup(c){const{t:s}=M();return(a,b)=>(d(),h("nav",{rol:"navigation","aria-label":t(s)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[e("ol",kt,[L(a.$slots,"default")])],8,wt))}},zt={class:"fr-text--sm fr-my-0"},At={class:"fr-grid-row fr-grid-row--right not-enlarged"},Ct=["href","title"],St=S({__name:"QualityScoreTooltipContent",props:{dataset:{}},setup(c){const{t:s}=M();return(a,b)=>(d(),h(q,null,[e("h5",zt,o(t(s)("Metadata quality:")),1),l(t(U),{passed:a.dataset.quality.dataset_description_quality,messagePassed:t(s)("Data description filled"),messageFailed:t(s)("Data description empty"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(t(U),{passed:a.dataset.quality.resources_documentation,messagePassed:t(s)("Files documented"),messageFailed:t(s)("Files documentation missing"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(t(U),{passed:a.dataset.quality.license,messagePassed:t(s)("License filled"),messageFailed:t(s)("No license set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(t(U),{passed:a.dataset.quality.update_frequency&&!!a.dataset.quality.update_fulfilled_in_time,messagePassed:t(s)("Update frequency followed"),messageFailed:a.dataset.quality.update_frequency?t(s)("Update frequency not followed"):t(s)("Update frequency not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(t(U),{passed:a.dataset.quality.has_open_format,messagePassed:t(s)("File formats are open"),messageFailed:t(s)("File formats are closed"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(t(U),{passed:a.dataset.quality.temporal_coverage,messagePassed:t(s)("Temporal coverage filled"),messageFailed:t(s)("Temporal coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(t(U),{passed:a.dataset.quality.spatial,messagePassed:t(s)("Spatial coverage filled"),messageFailed:t(s)("Spatial coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(t(U),{passed:a.dataset.quality.all_resources_available,messagePassed:t(s)("All files are available"),messageFailed:t(s)("Some files are unavailable"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),e("div",At,[e("a",{href:t(Se),target:"_blank",rel:"noopener",title:t(s)("Learn more about this indicator - opens a new window")},o(t(s)("Learn more about this indicator")),9,Ct)])],64))}}),ye=S({__name:"AdminBadge",props:{type:{}},setup(c){return(s,a)=>(d(),h("p",{class:Q(["fr-badge",{"fr-badge--blue-cumulus":s.type==="info","fr-badge--error fr-badge--no-icon":s.type==="error","fr-badge--warning fr-badge--no-icon":s.type==="warning","fr-badge--success fr-badge--no-icon":s.type==="success"}])},[L(s.$slots,"default")],2))}}),Dt=["aria-describedby"],Rt=["id"],Mt=S({inheritAttrs:!1,__name:"AdminContentWithTooltip",setup(c){const s=E(),a=k(),b=k("");return Z(()=>{a.value&&(b.value=a.value.textContent||"")}),(n,r)=>(d(),h(q,null,[e("p",ne(n.$attrs,{"aria-describedby":t(s),ref_key:"contentRef",ref:a}),[L(n.$slots,"default",{},void 0,!0)],16,Dt),e("span",{class:"fr-hidden-xl fr-tooltip fr-placement",id:t(s),role:"tooltip","aria-hidden":"true"},o(b.value),9,Rt)],64))}});const $e=W(Mt,[["__scopeId","data-v-d192f17a"]]),Tt=S({__name:"AdminLoader",props:{scale:{default:4}},setup(c){return me(De),(s,a)=>(d(),C(t(pe),{name:"ri-loader-5-line",animation:"spin",scale:s.scale,fill:"var(--blue-cumulus-sun-368-moon-732)"},null,8,["scale"]))}}),qt={class:"fr-table fr-mb-2w"},Pt=S({__name:"AdminTable",props:{loading:{type:Boolean,default:!1}},setup(c){return(s,a)=>(d(),h("div",qt,[e("table",null,[L(s.$slots,"default",{},void 0,!0)]),s.loading?(d(),C(x,{key:0,class:"fr-p-4w text-align-center"},{default:m(()=>[l(Tt)]),_:1})):A("",!0)]))}});const ue=W(Pt,[["__scopeId","data-v-cae574a4"]]),Bt={class:"fr-text--bold"},Ot={key:1,class:"fr-grid-row fr-grid-row--middle justify-between"},It=["title"],Lt=S({__name:"AdminTableTh",props:{sorted:{}},emits:["sort"],setup(c,{emit:s}){const a=c,b=s,{t:n}=M(),r=B(()=>a.sorted!==void 0);function i(){return a.sorted==="desc"?b("sort","asc"):b("sort","desc")}return(f,_)=>(d(),h("th",Bt,[r.value?(d(),h("div",Ot,[L(f.$slots,"default",{},void 0,!0),e("button",{class:Q(["fr-ml-1w fr-btn fr-btn--sm fr-btn--tertiary-no-outline",{"fr-icon-arrow-down-line":!f.sorted||f.sorted==="asc","fr-icon-arrow-up-line":f.sorted==="desc","text-grey-500":f.sorted,"text-mention-grey":!f.sorted}]),onClick:i,title:t(n)("Sort")},o(t(n)("Sort")),11,It)])):L(f.$slots,"default",{key:0},void 0,!0)]))}});const R=W(Lt,[["__scopeId","data-v-5acf0bf0"]]),Ft=["aria-describedby"],Ut=["id"],O=S({__name:"Tooltip",setup(c){const s=E("tooltip");return(a,b)=>(d(),h(q,null,[e("p",ne(a.$attrs,{"aria-describedby":t(s)}),[L(a.$slots,"default")],16,Ft),e("span",{class:"fr-tooltip fr-placement",id:t(s),role:"tooltip","aria-hidden":"true"},[L(a.$slots,"tooltip")],8,Ut)],64))}}),Et=["href"],Vt={class:"monospace"},Nt={class:"monospace"},jt={class:"monospace"},Ht={class:"monospace"},Wt={class:"monospace"},Yt=S({__name:"AdminDatasetsTable",props:{datasets:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(c,{emit:s}){const a=s,b=c,{t:n}=M();function r(g,p){a("sort",g,p)}function i(g){return b.sortedBy===g?b.sortDirection:null}function f(g){return Array.isArray(g.resources)?g.resources.length:g.resources.total}function _(g){return"".concat(re,"dataset/").concat(g.id,"/")}function $(g){return g.deleted?{label:n("Deleted"),type:"error"}:g.archived?{label:n("Archived"),type:"warning"}:g.private?{label:n("Private"),type:"default"}:{label:n("Public"),type:"info"}}return(g,p)=>(d(),C(ue,{loading:g.loading},{default:m(()=>[e("thead",null,[e("tr",null,[l(R,{onSort:p[0]||(p[0]=u=>r("title",u)),sorted:i("title"),scope:"col"},{default:m(()=>[w(o(t(n)("Title of the dataset")),1)]),_:1},8,["sorted"]),l(R,{scope:"col"},{default:m(()=>[w(o(t(n)("Status")),1)]),_:1}),l(R,{onSort:p[1]||(p[1]=u=>r("created",u)),sorted:i("created"),scope:"col"},{default:m(()=>[w(o(t(n)("Created at")),1)]),_:1},8,["sorted"]),l(R,{onSort:p[2]||(p[2]=u=>r("last_update",u)),sorted:i("last_update"),scope:"col"},{default:m(()=>[w(o(t(n)("Updated at")),1)]),_:1},8,["sorted"]),l(R,{scope:"col"},{default:m(()=>[w(o(t(n)("Files")),1)]),_:1}),l(R,{scope:"col"},{default:m(()=>[w(o(t(n)("Score")),1)]),_:1}),l(R,{scope:"col"},{default:m(()=>[l(O,null,{tooltip:m(()=>[w(o(t(n)("Discussions")),1)]),default:m(()=>[p[6]||(p[6]=e("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),l(R,{onSort:p[3]||(p[3]=u=>r("views",u)),sorted:i("views"),scope:"col"},{default:m(()=>[l(O,null,{tooltip:m(()=>[w(o(t(n)("Views")),1)]),default:m(()=>[p[7]||(p[7]=e("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),l(R,{scope:"col"},{default:m(()=>[l(O,null,{tooltip:m(()=>[w(o(t(n)("Downloads")),1)]),default:m(()=>[p[8]||(p[8]=e("span",{class:"fr-icon--sm fr-icon-download-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),l(R,{onSort:p[4]||(p[4]=u=>r("reuses",u)),sorted:i("reuses"),scope:"col"},{default:m(()=>[l(O,null,{tooltip:m(()=>[w(o(t(n)("Reuses")),1)]),default:m(()=>[p[9]||(p[9]=e("span",{class:"fr-icon--sm fr-icon-line-chart-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),l(R,{onSort:p[5]||(p[5]=u=>r("followers",u)),sorted:i("followers"),scope:"col"},{default:m(()=>[l(O,null,{tooltip:m(()=>[w(o(t(n)("Favorites")),1)]),default:m(()=>[p[10]||(p[10]=e("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])])]),e("tbody",null,[(d(!0),h(q,null,j(g.datasets,u=>{var v;return d(),h("tr",{key:u.id},[e("td",null,[l($e,null,{default:m(()=>[e("a",{class:"fr-link fr-reset-link",href:_(u)},[l(t(K),{text:u.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Et)]),_:2},1024)]),e("td",null,[l(ye,{type:$(u).type},{default:m(()=>[w(o($(u).label),1)]),_:2},1032,["type"])]),e("td",null,o(t(H)(u.created_at)),1),e("td",null,o(t(H)(u.last_modified)),1),e("td",null,o(f(u)),1),e("td",null,[l(O,null,{tooltip:m(()=>[l(St,{dataset:u},null,8,["dataset"])]),default:m(()=>[l(t(Re),{class:"w-100",score:u.quality.score},null,8,["score"])]),_:2},1024)]),e("td",Vt,o(t(I)(u.metrics.discussions)),1),e("td",Nt,o(t(I)(u.metrics.views)),1),e("td",jt,o(t(I)((v=u.metrics.resources_downloads)!=null?v:0)),1),e("td",Ht,o(t(I)(u.metrics.reuses)),1),e("td",Wt,o(t(I)(u.metrics.followers)),1)])}),128))])]),_:1},8,["loading"]))}}),fe=k(null);function G(){const c=s=>{fe.value=s};return{currentOrganization:ze(fe),setCurrentOrganization:c}}const Gt="/_themes/gouvfr/assets/logotype-white.svg",Jt=["href"],Kt=["src","alt"],we=S({__name:"AdminPublishButton",props:{type:{}},setup(c){const s=c,{t:a}=M(),b=B(()=>{switch(s.type){case"dataset":return Te;case"reuse":return Me}});return(n,r)=>(d(),h("a",{href:b.value,class:"fr-btn fr-icon-add-line fr-btn--icon-left"},[w(o(t(a)("Publish on"))+" ",1),e("img",{class:"fr-ml-1v",src:t(Gt),loading:"lazy",alt:t(be)},null,8,Kt)],8,Jt))}}),Qt={key:0},Zt={class:"fr-breadcrumb__link","aria-current":"page"},Xt={class:"fr-h3 fr-mb-5v"},xt={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},es={class:"fr-col"},ts={class:"subtitle subtitle--uppercase fr-m-0"},ss={key:0,class:"fr-col-auto fr-grid-row fr-grid-row--middle"},os=["href"],as={class:"text-align-center fr-py-1w"},ns=["src"],rs={class:"fr-text--bold fr-my-3v"},ls=S({__name:"Datasets",props:{oid:{}},setup(c){const{t:s}=M(),a=c,b=k([]),n=k(!1),r=k(1),i=k(10),f=k(0),_=k("created"),$=k("desc"),g=B(()=>"".concat($.value==="asc"?"":"-").concat(_.value)),p=k(""),u=qe(p,Ie),{currentOrganization:v}=G();function z(y,D){_.value=y,$.value=D}return X(async()=>{n.value=!0,b.value=[];try{const y=await Pe(a.oid,u.value,r.value,i.value,g.value);b.value=y.data,r.value=y.page,i.value=y.page_size,f.value=y.total}finally{n.value=!1}}),(y,D)=>{const P=F("router-link");return d(),h("div",null,[l(Y,null,{default:m(()=>[e("li",null,[l(P,{class:"fr-breadcrumb__link",to:"/"},{default:m(()=>[w(o(t(s)("Administration")),1)]),_:1})]),t(v)?(d(),h("li",Qt,[l(P,{class:"fr-breadcrumb__link",to:"/"},{default:m(()=>[w(o(t(v).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",Zt,o(t(s)("Datasets")),1)])]),_:1}),e("h1",Xt,o(t(s)("Datasets")),1),e("div",xt,[e("div",es,[e("h2",ts,o(t(s)("{n} datasets",f.value)),1)]),f.value?(d(),h("div",ss,[e("div",null,[e("a",{href:t(Be)(y.oid),class:"fr-btn fr-btn--sm fr-icon-download-line fr-btn--icon-left"},o(t(s)("Download catalog")),9,os)])])):A("",!0)]),n.value||f.value>0?(d(),C(Yt,{key:0,datasets:b.value,loading:n.value,"sort-direction":$.value,sortedBy:_.value,onSort:z},null,8,["datasets","loading","sort-direction","sortedBy"])):(d(),C(x,{key:1,class:"fr-my-2w"},{default:m(()=>[e("div",as,[e("img",{src:t(Oe),alt:"",loading:"lazy"},null,8,ns),e("p",rs,o(t(s)("You haven't published a dataset yet")),1),l(we,{type:"dataset"})])]),_:1})),f.value>i.value?(d(),C(t(le),{key:2,page:r.value,"page-size":i.value,"total-results":f.value,onChange:D[0]||(D[0]=T=>r.value=T)},null,8,["page","page-size","total-results"])):A("",!0)])}}}),is=["href"],ds={class:"monospace"},us={class:"monospace"},cs={class:"monospace"},fs={class:"monospace"},_s=S({__name:"AdminReusesTable",props:{reuses:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(c){const s=c,{t:a}=M();function b(i){return s.sortedBy===i?s.sortDirection:null}function n(i){return"".concat(re,"reuse/").concat(i.id,"/")}function r(i){return i.deleted?{label:a("Deleted"),type:"error"}:i.archived?{label:a("Archived"),type:"warning"}:i.private?{label:a("Private"),type:"default"}:{label:a("Public"),type:"info"}}return(i,f)=>(d(),C(ue,{loading:i.loading},{default:m(()=>[e("thead",null,[l(R,{onSort:f[0]||(f[0]=_=>i.$emit("sort","title",_)),sorted:b("title"),scope:"col"},{default:m(()=>[w(o(t(a)("Reuse title")),1)]),_:1},8,["sorted"]),l(R,null,{default:m(()=>[w(o(t(a)("Status")),1)]),_:1}),l(R,{onSort:f[1]||(f[1]=_=>i.$emit("sort","created",_)),sorted:b("created"),scope:"col"},{default:m(()=>[w(o(t(a)("Created at")),1)]),_:1},8,["sorted"]),l(R,{onSort:f[2]||(f[2]=_=>i.$emit("sort","datasets",_)),sorted:b("datasets"),scope:"col"},{default:m(()=>[w(o(t(a)("Datasets")),1)]),_:1},8,["sorted"]),l(R,{scope:"col"},{default:m(()=>[l(O,null,{tooltip:m(()=>[w(o(t(a)("Discussions")),1)]),default:m(()=>[f[5]||(f[5]=e("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),l(R,{onSort:f[3]||(f[3]=_=>i.$emit("sort","views",_)),sorted:b("views"),scope:"col"},{default:m(()=>[l(O,null,{tooltip:m(()=>[w(o(t(a)("Views")),1)]),default:m(()=>[f[6]||(f[6]=e("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),l(R,{onSort:f[4]||(f[4]=_=>i.$emit("sort","followers",_)),sorted:b("followers"),scope:"col"},{default:m(()=>[l(O,null,{tooltip:m(()=>[w(o(t(a)("Favorites")),1)]),default:m(()=>[f[7]||(f[7]=e("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])]),e("tbody",null,[(d(!0),h(q,null,j(i.reuses,_=>(d(),h("tr",null,[e("td",null,[l($e,null,{default:m(()=>[e("a",{class:"fr-link fr-reset-link",href:n(_)},[l(t(K),{text:_.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,is)]),_:2},1024)]),e("td",null,[l(ye,{type:r(_).type},{default:m(()=>[w(o(r(_).label),1)]),_:2},1032,["type"])]),e("td",null,o(t(H)(_.created_at)),1),e("td",ds,o(t(I)(_.datasets.length)),1),e("td",us,o(t(I)(_.metrics.discussions)),1),e("td",cs,o(t(I)(_.metrics.views)),1),e("td",fs,o(t(I)(_.metrics.followers)),1)]))),256))])]),_:1},8,["loading"]))}}),ms="/_themes/gouvfr/assets/reuse.svg",ps={class:"fr-container--fluid"},bs={key:0},gs={class:"fr-breadcrumb__link","aria-current":"page"},vs={class:"fr-h3"},hs={class:"subtitle subtitle--uppercase"},ys={class:"text-align-center fr-py-1w"},$s=["src"],ws={class:"fr-text--bold fr-my-3v"},ks=S({__name:"Reuses",props:{oid:{}},setup(c){const{t:s}=M(),a=c,b=k([]),n=k(!1),r=k(1),i=k(10),f=k(0),_=k("created"),$=k("desc"),g=B(()=>"".concat($.value==="asc"?"":"-").concat(_.value)),{currentOrganization:p}=G();function u(v,z){_.value=v,$.value=z}return X(async()=>{n.value=!0,b.value=[];try{const v=await Le(a.oid,r.value,i.value,g.value);b.value=v.data,r.value=v.page,i.value=v.page_size,f.value=v.total}finally{n.value=!1}}),(v,z)=>{const y=F("router-link");return d(),h("div",ps,[l(Y,null,{default:m(()=>[e("li",null,[l(y,{class:"fr-breadcrumb__link",to:"/"},{default:m(()=>[w(o(t(s)("Administration")),1)]),_:1})]),t(p)?(d(),h("li",bs,[l(y,{class:"fr-breadcrumb__link",to:"/"},{default:m(()=>[w(o(t(p).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",gs,o(t(s)("Reuses")),1)])]),_:1}),e("h1",vs,o(t(s)("Reuses")),1),e("h2",hs,o(t(s)("{n} reuses of your organization",b.value.length)),1),n.value||f.value>0?(d(),C(_s,{key:0,reuses:b.value,loading:n.value,sortDirection:$.value,sortedBy:_.value,onSort:u},null,8,["reuses","loading","sortDirection","sortedBy"])):(d(),C(x,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:m(()=>[e("div",ys,[e("img",{src:t(ms),alt:"",loading:"lazy"},null,8,$s),e("p",ws,o(t(s)("You haven't published a reuse yet")),1),l(we,{type:"reuse"})])]),_:1})),f.value>i.value?(d(),C(t(le),{key:2,page:r.value,"page-size":i.value,"total-results":f.value,onChange:z[0]||(z[0]=D=>r.value=D)},null,8,["page","page-size","total-results"])):A("",!0)])}}}),zs={class:"fr-breadcrumb__link","aria-current":"page"},As={key:0,class:"fr-h1"},Cs={class:"fr-alert fr-alert--info"},Ss={class:"fr-alert__title"},Ds={href:"/admin/me/"},Rs=S({__name:"Me",setup(c){const{t:s}=M(),a=k(null);return Z(async()=>a.value=await ie()),(b,n)=>{const r=F("router-link");return d(),h("div",null,[l(Y,null,{default:m(()=>[e("li",null,[l(r,{class:"fr-breadcrumb__link",to:"/"},{default:m(()=>[w(o(t(s)("Administration")),1)]),_:1})]),e("li",null,[e("a",zs,o(t(s)("Me")),1)])]),_:1}),a.value?(d(),h("h1",As,o(a.value.first_name)+" "+o(a.value.last_name),1)):A("",!0),e("div",Cs,[e("h3",Ss,o(t(s)("This is a WIP page")),1),e("p",null,[e("a",Ds,o(t(s)("You can edit your profil on the current admin.")),1)])])])}}}),Ms='<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n',Ts={class:"fr-sidemenu__item"},qs=["innerHTML"],Ps=S({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup(c){return(s,a)=>{const b=F("router-link");return d(),h("li",Ts,[e("div",{class:Q([{"fr-icon-svg fr-icon--sm":s.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[s.iconHtml?(d(),h("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:s.iconHtml},null,8,qs)):s.icon?(d(),h("div",{key:1,class:Q([s.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):A("",!0),l(b,{to:s.to},{default:m(()=>[w(o(s.label),1)]),_:1},8,["to"])],2)])}}});const V=W(Ps,[["__scopeId","data-v-5e2ff0a8"]]),Bs=["aria-expanded","aria-controls","aria-current"],Os={class:"fr-mx-1w"},Is={class:"logo logo--sm"},Ls={class:"fr-mx-1w fr-col text-overflow-ellipsis"},Fs=["id"],Us={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},Es=S({__name:"AdminSidebarMenu",props:{user:{},organization:{},isOpened:{type:Boolean}},emits:["open","click"],setup(c){const s=c,{t:a}=M(),b=E("menu");function n(r,i){const f=document.getElementById(b);i(f)&&(r?i(f).collapse.disclose():i(f).collapse.conceal())}return Ae(()=>{setTimeout(()=>{n(s.isOpened,globalThis.dsfr)},200)}),(r,i)=>(d(),h("li",{class:Q(["fr-sidemenu__item",{"fr-sidemenu__item--active":r.isOpened}])},[e("button",{class:"fr-sidemenu__btn","aria-expanded":r.isOpened,"aria-controls":t(b),"aria-current":r.isOpened,onClick:i[0]||(i[0]=f=>r.$emit("open"))},[r.user?(d(),h(q,{key:0},[r.user?(d(),C(t(se),{key:0,user:r.user,size:24,rounded:!0},null,8,["user"])):A("",!0),e("p",Os,o(t(a)("My Profil")),1)],64)):r.organization?(d(),h(q,{key:1},[e("div",Is,[l(Fe,{type:"organization",src:r.organization.logo_thumbnail,size:20},null,8,["src"])]),e("p",Ls,o(r.organization.name),1)],64)):A("",!0)],8,Bs),e("div",{class:"fr-collapse","data-fr-js-collapse":"",id:t(b)},[e("ul",Us,[r.user?(d(),C(V,{key:0,icon:"fr-icon-account-circle-line",label:t(a)("Me"),to:"/me"},null,8,["label"])):r.organization?(d(),h(q,{key:1},[l(V,{iconHtml:t(Ms),label:t(a)("Datasets"),to:{name:"organization-datasets",params:{oid:r.organization.id}},onClick:i[1]||(i[1]=f=>r.$emit("click"))},null,8,["iconHtml","label","to"]),l(V,{icon:"fr-icon-line-chart-line",label:t(a)("Reuses"),to:{name:"organization-reuses",params:{oid:r.organization.id}},onClick:i[2]||(i[2]=f=>r.$emit("click"))},null,8,["label","to"]),l(V,{icon:"fr-icon-chat-3-line",label:t(a)("Discussions"),to:{name:"organization-discussions",params:{oid:r.organization.id}},onClick:i[3]||(i[3]=f=>r.$emit("click"))},null,8,["label","to"]),l(V,{icon:"fr-icon-parent-line",label:t(a)("Members"),to:{name:"organization-members",params:{oid:r.organization.id}}},null,8,["label","to"]),l(V,{icon:"fr-icon-user-line",label:t(a)("Profile"),to:{name:"organization-profile",params:{oid:r.organization.id}}},null,8,["label","to"])],64)):A("",!0)])],8,Fs)],2))}});const _e=W(Es,[["__scopeId","data-v-0baf171a"]]),Vs={class:"fr-container--fluid h-100"},Ns={class:"fr-grid-row h-100 bg-grey-50"},js={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},Hs=["aria-label"],Ws={class:"fr-sidemenu__inner"},Ys=["aria-controls"],Gs=["id"],Js={class:"fr-sidemenu__list"},Ks={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w"},Qs=S({__name:"Admin",setup(c){const{t:s}=M(),a=Ue(),b=E("menu"),n=k(null),r=k(),{setCurrentOrganization:i}=G(),f=ge();function _(g){return g===r.value}function $(g){r.value=g.id}return Z(async()=>{var g,p;if(n.value=await ie(),a.name||(n.value.organizations.length>0?f.replace({name:"organization-datasets",params:{oid:n.value.organizations[0].id}}):f.replace({name:"me"})),a.name==="me")r.value=(g=N)==null?void 0:g.id;else if(n.value.organizations.length>0){let u=n.value.organizations[0];a.params.oid&&(u=(p=n.value.organizations.find(v=>v.id===a.params.oid))!=null?p:u),$(u),i(u)}}),(g,p)=>{const u=F("router-view");return d(),h("div",Vs,[e("div",Ns,[e("div",js,[e("nav",{class:"fr-sidemenu fr-pr-0","aria-label":t(s)("Administration menu")},[e("div",Ws,[e("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":t(b),"aria-expanded":"false"},o(t(s)("Open menu")),9,Ys),e("div",{class:"fr-collapse",id:t(b)},[e("ul",Js,[t(N)?(d(),C(_e,{key:0,user:t(N),"is-opened":_(t(N).id),onOpen:p[0]||(p[0]=v=>$(t(N)))},null,8,["user","is-opened"])):A("",!0),n.value?(d(!0),h(q,{key:1},j(n.value.organizations,v=>(d(),C(_e,{organization:v,"is-opened":_(v.id),onOpen:()=>$(v),onClick:()=>t(i)(v)},null,8,["organization","is-opened","onOpen","onClick"]))),256)):A("",!0)])],8,Gs)])],8,Hs)]),e("div",Ks,[(d(),C(u,{key:t(a).fullPath,class:"fr-container--fluid"}))])])])}}});const Zs=W(Qs,[["__scopeId","data-v-1057ebbe"]]),Xs=["aria-labelledby","id"],xs={class:"fr-container fr-container--fluid fr-container-md"},eo={class:"fr-grid-row fr-grid-row--center"},to={class:"fr-col-12 fr-col-md-8"},so={class:"fr-modal__body"},oo={class:"fr-modal__header"},ao=["title","aria-controls"],no={class:"fr-modal__content"},ro=["id"],lo={class:"fr-modal__footer"},io={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},uo=["disabled"],co=["disabled"],fo=S({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(c,{emit:s}){const a=c,b=s,{t:n}=M(),{toast:r}=oe(),i=k(!1),f=k(),_=k("editor"),$=B(()=>"fr-modal-title-user-"+a.id);async function g(){try{i.value=!0,f.value&&(await Ve(a.oid,f.value,_.value),b("memberAdded"),u())}catch(v){r.error(n("An error occurred while update member role."))}finally{i.value=!1}}function p(v){return v.map(z=>{var D;const y={...z,avatar_thumbnail:(D=z.avatar_url)!=null?D:void 0};return{value:y.id,label:y.first_name+" "+y.last_name,image:Ne(y,32)}})}function u(){i.value=!1,f.value=void 0,_.value="editor";const v=document.getElementById(a.id);globalThis.dsfr(v).modal.conceal()}return(v,z)=>(d(),C(te,{to:"body"},[e("dialog",{"aria-labelledby":$.value,role:"dialog",id:v.id,class:"fr-modal"},[e("div",xs,[e("div",eo,[e("div",to,[e("div",so,[e("div",oo,[e("button",{class:"fr-btn--close fr-btn",title:t(n)("Close the modal dialog"),"aria-controls":v.id},o(t(n)("Close")),9,ao)]),e("form",{onSubmit:ee(g,["prevent"])},[e("div",no,[e("h1",{id:$.value,class:"fr-modal__title fr-mb-2w"},o(t(n)("Add member to the organization")),9,ro),l(Ee,{placeholder:v.$t("Search a user"),searchPlaceholder:v.$t("Search a user..."),suggestUrl:"/users/suggest/",values:f.value,onChange:z[0]||(z[0]=y=>f.value=y),allOption:v.$t("Select a user"),addAllOption:!1,onSuggest:p,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),v.roles.length>0?(d(),C(ve,{key:0,label:t(n)("Role of the member"),"model-value":_.value,"onUpdate:modelValue":z[1]||(z[1]=y=>_.value=y),options:v.roles},null,8,["label","model-value","options"])):A("",!0)]),e("div",lo,[e("div",io,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:u,disabled:i.value},o(t(n)("Cancel")),9,uo),e("button",{class:"fr-btn",type:"submit",disabled:i.value},o(t(n)("Add to the organization")),9,co)])])],32)])])])])],8,Xs)]))}}),_o=["aria-controls"],mo=S({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(c){const s=c,{t:a}=M(),b=B(()=>"fr-modal-add-user-"+s.oid);return(n,r)=>(d(),h(q,null,[e("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":b.value},o(t(a)("Add member")),9,_o),l(fo,{id:b.value,oid:n.oid,roles:n.roles,onMemberAdded:r[0]||(r[0]=i=>n.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),po={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},ke=S({__name:"AdminDangerZone",setup(c){return(s,a)=>(d(),C(t(je),{color:"error",type:"secondary",weight:"regular"},{default:m(()=>[e("div",po,[L(s.$slots,"default")])]),_:3}))}}),bo=["aria-labelledby","id"],go={class:"fr-container fr-container--fluid fr-container-md"},vo={class:"fr-grid-row fr-grid-row--center"},ho={class:"fr-col-12 fr-col-md-8"},yo={class:"fr-modal__body"},$o={class:"fr-modal__header"},wo=["title","aria-controls"],ko={class:"fr-modal__content"},zo=["id"],Ao={class:"fr-grid-row fr-grid-row--middle fr-text--bold fr-mb-2w"},Co={class:"fr-col"},So={class:"fr-col-auto"},Do=["disabled"],Ro={class:"fr-col"},Mo={class:"fr-m-0 text-grey-500"},To={class:"fr-m-0 fr-text--xs text-default-error"},qo={class:"fr-col-auto"},Po=["disabled"],Bo=S({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(c,{emit:s}){const a=c,b=s,n=B(()=>"fr-modal-title-user-"+a.id),{t:r}=M(),{toast:i}=oe(),f=k(!1);async function _(u){if(!u.newRole){p();return}try{f.value=!0,await He(a.oid,u.user.id,u.newRole),b("memberUpdated"),p()}catch(v){i.error(r("An error occurred while update member role."))}finally{f.value=!1}}async function $(u){try{f.value=!0,await We(a.oid,u.user.id),b("memberUpdated")}catch(v){i.error(r("An error occurred while removing this member."))}finally{f.value=!1}}function g(u){return a.roles.map(v=>{const z={...v};return z.value===u&&(z.selected=!0),z})}function p(){f.value=!1;const u=document.getElementById(a.id);globalThis.dsfr(u).modal.conceal()}return(u,v)=>(d(),C(te,{to:"body"},[e("dialog",{"aria-labelledby":n.value,role:"dialog",id:u.id,class:"fr-modal"},[e("div",go,[e("div",vo,[e("div",ho,[e("div",yo,[e("div",$o,[e("button",{class:"fr-btn--close fr-btn",title:t(r)("Close the modal dialog"),"aria-controls":u.id},o(t(r)("Close")),9,wo)]),e("div",ko,[e("h1",{id:n.value,class:"fr-modal__title fr-mb-2w"},o(t(r)("Edit member")),9,zo),e("p",Ao,[l(t(se),{class:"fr-mr-1v",user:u.member.user,rounded:!0,size:24},null,8,["user"]),w(" "+o(u.member.user.first_name)+" "+o(u.member.user.last_name),1)]),e("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:v[1]||(v[1]=ee(z=>_(u.member),["prevent"]))},[e("div",Co,[u.roles.length>0?(d(),C(ve,{key:0,label:t(r)("Role of the member"),"model-value":u.member.role,"onUpdate:modelValue":v[0]||(v[0]=z=>u.member.newRole=z),options:g(u.member.role)},null,8,["label","model-value","options"])):A("",!0)]),e("div",So,[e("button",{class:"fr-btn",type:"submit",disabled:f.value},o(t(r)("Validate")),9,Do)])],32),l(ke,{class:"fr-mt-2w"},{default:m(()=>[e("div",Ro,[e("p",Mo,o(t(r)("Remove member from the organization")),1),e("p",To,o(t(r)("Be careful, this action can't be reverse.")),1)]),e("div",qo,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:f.value,onClick:v[2]||(v[2]=z=>$(u.member))},o(t(r)("Remove member")),9,Po)])]),_:1})])])])])])],8,bo)]))}}),Oo=["aria-controls"],Io=S({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(c){const s=c,{t:a}=M(),b=B(()=>"fr-modal-user-"+s.member.user.id);return(n,r)=>(d(),h(q,null,[e("button",{class:"fr-btn fr-btn--sm fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":b.value},o(t(a)("Edit")),9,Oo),l(Bo,{id:b.value,member:n.member,oid:n.oid,roles:n.roles,onMemberUpdated:r[0]||(r[0]=i=>n.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),Lo={class:"fr-mt-n9v fr-mb-2w"},Fo={class:"fr-badge fr-badge--info fr-badge--no-icon"},Uo={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Eo={class:"fr-col"},Vo={class:"fr-grid-row fr-grid-row--middle"},No={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},jo={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},Ho=["disabled"],Wo=["disabled","aria-controls"],Yo=["aria-labelledby","id"],Go={class:"fr-container fr-container--fluid fr-container-md"},Jo={class:"fr-grid-row fr-grid-row--center"},Ko={class:"fr-col-12 fr-col-md-8"},Qo={class:"fr-modal__body"},Zo={class:"fr-modal__header"},Xo=["title","aria-controls"],xo={class:"fr-modal__content"},ea=["id"],ta={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},sa={class:"fr-col-auto"},oa=["disabled"],aa={class:"fr-col-auto"},na=["disabled"],ra=S({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(c,{emit:s}){const a=c,b=s,{t:n}=M(),r=k(""),i=E("modal"),f=E("modalTitle");function _(){const p=document.getElementById(i);globalThis.dsfr(p).modal.conceal()}function $(){b("refuse",a.request.id,r.value),_()}function g(){r.value="",_()}return(p,u)=>{const v=F("AdminMembershipRequest",!0);return d(),C(x,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:m(()=>[e("div",Lo,[e("p",Fo,[u[2]||(u[2]=e("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),w(" "+o(t(n)("Membership Request")),1)])]),e("div",Uo,[e("div",Eo,[e("div",Vo,[l(t(se),{class:"fr-mr-1v",user:p.request.user,rounded:!0,size:24},null,8,["user"]),w(" "+o(t(n)("{fullName} asks to join the organization.",{fullName:p.request.user.first_name+" "+p.request.user.last_name})),1)]),e("div",No,o(p.request.comment),1)]),p.showActions?(d(),h("div",jo,[e("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:u[0]||(u[0]=z=>p.$emit("accept",p.request.id)),disabled:p.loading,"data-testid":"accept"},o(t(n)("Accept request")),9,Ho),e("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:p.loading,"data-fr-opened":"false","aria-controls":t(i),"data-testid":"refuse"},o(t(n)("Refuse")),9,Wo),(d(),C(te,{to:"body"},[e("dialog",{"aria-labelledby":t(f),role:"dialog",id:t(i),class:"fr-modal","data-testid":"modal"},[e("div",Go,[e("div",Jo,[e("div",Ko,[e("div",Qo,[e("div",Zo,[e("button",{class:"fr-btn--close fr-btn",title:t(n)("Close the modal dialog"),"aria-controls":t(i),onClick:ee(g,["prevent"])},o(t(n)("Close")),9,Xo)]),e("div",xo,[e("h1",{id:t(f),class:"fr-modal__title fr-mb-2w"},o(t(n)("Refuse membership request")),9,ea),l(v,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:p.oid,request:p.request,"show-actions":!1},null,8,["oid","request"]),e("form",{onSubmit:ee($,["prevent"]),onReset:g},[l(Ye,{label:t(n)("You can provide the refusal reason:"),modelValue:r.value,"onUpdate:modelValue":u[1]||(u[1]=z=>r.value=z),"data-testid":"comment-group"},null,8,["label","modelValue"]),e("div",ta,[e("div",sa,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:p.loading,"data-testid":"cancel-modal-button"},o(t(n)("Cancel")),9,oa)]),e("div",aa,[e("button",{class:"fr-btn",type:"submit",disabled:p.loading,"data-testid":"refuse-modal-button"},o(t(n)("Refuse request")),9,na)])])],32)])])])])])],8,Yo)]))])):A("",!0)])]),_:1})}}}),la={key:0},ia={class:"fr-breadcrumb__link","aria-current":"page"},da={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},ua={class:"fr-col-12 fr-col-md"},ca={class:"fr-h1 fr-mb-2w"},fa={key:0,class:"fr-col-auto"},_a={class:"subtitle subtitle--uppercase"},ma={class:"subtitle subtitle--uppercase fr-mt-2w fr-mb-1v"},pa={class:"fr-table fr-table--layout-fixed"},ba={scope:"col"},ga={scope:"col"},va={scope:"col"},ha={scope:"col"},ya={scope:"col"},$a={key:0,scope:"col"},wa={class:"fr-badge"},ka={key:0},za={key:1},Aa={key:0},Ca=S({__name:"Members",props:{oid:{}},setup(c){const s=c,{t:a}=M(),{toast:b}=oe(),n=k([]),r=B(()=>Ge||_.value.some(y=>{var D;return y.user.id===((D=N)==null?void 0:D.id)&&y.role==="admin"})),i=k([]),{currentOrganization:f}=G(),_=k([]),$=k(!1);function g(y){var D,P;return(P=(D=i.value.find(T=>T.value===y))==null?void 0:D.label)!=null?P:y}async function p(){const y=await Ze(s.oid);_.value=y.members}async function u(){const y=await ce(s.oid);n.value=y}async function v(y){$.value=!0;const D=[];try{await Xe(s.oid,y),D.push(u()),D.push(p())}catch(P){b.error(a("An error occurred while accepting this membership."))}finally{Promise.all(D).finally(()=>$.value=!1)}}async function z(y,D){$.value=!0;const P=[];try{await xe(s.oid,y,D),P.push(u()),P.push(p())}catch(T){b.error(a("An error occurred while refusing this membership."))}finally{Promise.all(P).finally(()=>$.value=!1)}}return X(()=>{r.value&&ce(s.oid).then(y=>n.value=y)}),Z(()=>{Je().then(Ke).then(y=>i.value=y),p()}),(y,D)=>{const P=F("router-link");return d(),h("div",null,[l(Y,null,{default:m(()=>[e("li",null,[l(P,{class:"fr-breadcrumb__link",to:"/"},{default:m(()=>[w(o(t(a)("Administration")),1)]),_:1})]),t(f)?(d(),h("li",la,[l(P,{class:"fr-breadcrumb__link",to:"/"},{default:m(()=>[w(o(t(f).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",ia,o(t(a)("Members")),1)])]),_:1}),e("div",da,[e("div",ua,[e("h1",ca,o(t(a)("Members")),1)]),r.value?(d(),h("div",fa,[l(mo,{oid:y.oid,roles:i.value,onMemberAdded:p},null,8,["oid","roles"])])):A("",!0)]),n.value.length?(d(),h(q,{key:0},[e("h2",_a,o(t(a)("{n} requests",{n:n.value.length})),1),(d(!0),h(q,null,j(n.value,T=>(d(),C(ra,{class:"fr-mb-4w",key:T.id,loading:$.value,oid:y.oid,request:T,"show-actions":!0,onAccept:v,onRefuse:z},null,8,["loading","oid","request"]))),128))],64)):A("",!0),e("h2",ma,o(t(a)("{n} members",{n:_.value.length})),1),e("div",pa,[e("table",null,[e("thead",null,[e("tr",null,[e("th",ba,o(t(a)("Members")),1),e("th",ga,o(t(a)("Email")),1),e("th",va,o(t(a)("Status")),1),e("th",ha,o(t(a)("Member since")),1),e("th",ya,o(t(a)("Last connection")),1),r.value?(d(),h("th",$a,o(t(a)("Action")),1)):A("",!0)])]),e("tbody",null,[(d(!0),h(q,null,j(_.value,T=>(d(),h("tr",{key:T.user.id},[e("td",null,o(T.user.first_name)+" "+o(T.user.last_name),1),e("td",null,o(T.user.email),1),e("td",null,[e("p",wa,o(g(T.role)),1)]),e("td",null,o(t(H)(T.since)),1),e("td",null,[T.user.last_login_at?(d(),h("span",ka,o(t(Qe)(T.user.last_login_at)),1)):(d(),h("span",za,o(t(a)("No connection")),1))]),r.value?(d(),h("td",Aa,[l(Io,{member:T,oid:y.oid,roles:i.value,onMemberUpdated:p},null,8,["member","oid","roles"])])):A("",!0)]))),128))])])])])}}}),Sa={class:"fr-container--fluid"},Da={key:0},Ra={class:"fr-breadcrumb__link","aria-current":"page"},Ma=["id"],Ta=["disabled","onClick"],qa={class:"fr-col"},Pa={class:"fr-m-0 text-grey-500"},Ba={class:"fr-m-0 fr-text--xs text-default-error"},Oa={class:"fr-col-auto"},Ia=["disabled","aria-controls"],La=["aria-labelledby","id"],Fa={class:"fr-container fr-container--fluid fr-container-md"},Ua={class:"fr-grid-row fr-grid-row--center"},Ea={class:"fr-col-12 fr-col-md-8"},Va={class:"fr-modal__body"},Na={class:"fr-modal__header"},ja=["title","aria-controls"],Ha={class:"fr-modal__content"},Wa=["id"],Ya={class:"fr-text--bold"},Ga={class:"fr-modal__footer"},Ja={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},Ka=["disabled"],Qa=S({__name:"Profile",props:{oid:{}},setup(c){const{t:s}=M(),{toast:a}=oe(),b=ge(),n=k(null),r=k(null),{currentOrganization:i}=G(),f=k([]),_=k(!1),$=E("modal"),g=E("modalTitle");function p(){i.value&&(_.value=!0,tt(i.value.id).then(()=>{b.replace("/"),window.location.reload()}).catch(()=>a.error(s("An error occured when deleting the organization."))).finally(()=>_.value=!1))}function u(v){_.value=!0,st(v).then(()=>a.success(s("Organization updated !"))).catch(()=>a.error(s("An error occured when updating the organization."))).finally(()=>_.value=!1)}return Z(async()=>n.value=await ie()),(v,z)=>{const y=F("router-link");return d(),h("div",Sa,[l(Y,null,{default:m(()=>[e("li",null,[l(y,{class:"fr-breadcrumb__link",to:"/"},{default:m(()=>[w(o(t(s)("Administration")),1)]),_:1})]),t(i)?(d(),h("li",Da,[l(y,{class:"fr-breadcrumb__link",to:"/"},{default:m(()=>[w(o(t(i).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",Ra,o(t(s)("Profile")),1)])]),_:1}),r.value?(d(),h("h2",{key:0,class:"subtitle subtitle--uppercase fr-mb-5v",id:r.value.legend},o(t(s)("Edit profile")),9,Ma)):A("",!0),t(i)?(d(),C(et,{key:1,organization:t(i),errors:f.value,showLegend:!1,showWell:!1,ref_key:"form",ref:r,onSubmit:u},{submitButton:m(({submit:D})=>[e("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:_.value,"data-testid":"submitButton",onClick:D},o(t(s)("Save")),9,Ta)]),default:m(()=>[l(ke,{class:"fr-mt-6w"},{default:m(()=>[e("div",qa,[e("p",Pa,o(t(s)("Delete the organization")),1),e("p",Ba,o(t(s)("Be careful, this action can't be reverse.")),1)]),e("div",Oa,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:_.value,"data-fr-opened":"false","aria-controls":t($)},o(t(s)("Delete")),9,Ia),(d(),C(te,{to:"body"},[e("dialog",{"aria-labelledby":t(g),role:"dialog",id:t($),class:"fr-modal"},[e("div",Fa,[e("div",Ua,[e("div",Ea,[e("div",Va,[e("div",Na,[e("button",{class:"fr-btn--close fr-btn",title:t(s)("Close the modal dialog"),"aria-controls":t($)},o(t(s)("Close")),9,ja)]),e("div",Ha,[e("h1",{id:t(g),class:"fr-modal__title fr-mb-2w"},o(t(s)("Are you sure you want to delete this organization ?")),9,Wa),e("p",Ya,o(t(s)("This action can't be reverse.")),1),e("p",null,o(t(s)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),e("p",null,o(t(s)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),e("div",Ga,[e("div",Ja,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:_.value,onClick:p},o(t(s)("Delete")),9,Ka)])])])])])])],8,La)]))])]),_:1})]),_:1},8,["organization","errors"])):A("",!0)])}}});async function Za(c){return(await de.get("posts/".concat(c,"/"))).data}async function Xa(c){return(await de.get("dataservices/".concat(c,"/"))).data}me(rt,nt,at,ot);async function xa(c,s,a,b){return(await de.get(lt("discussions/"),{params:{org:c,sort:b,page_size:a,page:s}})).data}async function en(c){switch(c.class){case"Dataservice":return Xa(c.id);case"Dataset":return dt(c.id);case"Post":return Za(c.id);case"Reuse":return it(c.id);default:return null}}function tn(c,s){return c===null?null:{title:sn(c),icon:an(s),page:on(c)}}function sn(c){return c===null?"":"title"in c?c.title:"headline"in c?c.headline:he(c,"Unknown type ".concat(c))}function on(c){return c===null?"":"page"in c?c.page:"self_web_url"in c?c.self_web_url:he(c,"Unknown type ".concat(c))}function an(c){switch(c){case"Dataservice":return"ri-terminal-line";case"Dataset":return"ri-database-2-line";case"Post":return"ri-article-line";case"Reuse":return"ri-line-chart-line";default:return""}}const nn={class:"fr-text--bold"},rn={key:0},ln=["href"],dn={class:"inline-flex"},un=["href"],cn=S({__name:"AdminDiscussionsTable",props:{discussions:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(c){const s=c,{t:a}=M(),b=k({}),n=k({});X(async()=>{for(const _ of s.discussions)if(!(_.subject.id in b.value)){const $=en(_.subject);b.value[_.subject.id]=$;const g=await b.value[_.subject.id];n.value[_.subject.id]=tn(g,_.subject.class)}});function r(_,$){return $?$.page+"#/discussions/"+_:""}function i(_){return s.sortedBy===_?s.sortDirection:null}function f(_){return _.discussion.slice(-1)[0]}return(_,$)=>(d(),C(ue,{class:"fr-table--layout-fixed",loading:_.loading},{default:m(()=>[e("thead",null,[l(R,{onSort:$[0]||($[0]=g=>_.$emit("sort","title",g)),sorted:i("title"),scope:"col"},{default:m(()=>[w(o(t(a)("Discussion")),1)]),_:1},8,["sorted"]),l(R,{scope:"col"},{default:m(()=>[w(o(t(a)("Number of comments")),1)]),_:1}),l(R,{scope:"col"},{default:m(()=>[w(o(t(a)("Last comment")),1)]),_:1}),l(R,{onSort:$[1]||($[1]=g=>_.$emit("sort","closed",g)),sorted:i("closed"),scope:"col"},{default:m(()=>[w(o(t(a)("Closed at")),1)]),_:1},8,["sorted"]),l(R,{scope:"col",style:{width:"25%"}},{default:m(()=>[w(o(t(a)("URL")),1)]),_:1})]),e("tbody",null,[(d(!0),h(q,null,j(_.discussions,g=>{var p,u,v;return d(),h("tr",null,[e("td",null,[e("p",nn,[l(t(K),{text:g.title,"auto-resize":!0,"max-lines":1},null,8,["text"])]),n.value[g.subject.id]?(d(),h("p",rn,[e("a",{class:"fr-link inline-flex",href:(p=n.value[g.subject.id])==null?void 0:p.page},[l(t(pe),{height:12,class:"self-center",name:(u=n.value[g.subject.id])==null?void 0:u.icon},null,8,["name"]),l(t(K),{class:"overflow-wrap-anywhere",text:(v=n.value[g.subject.id])==null?void 0:v.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,ln)])):A("",!0)]),e("td",null,o(g.discussion.length),1),e("td",null,[e("div",null,[e("p",null,o(t(H)(f(g).posted_on)),1),e("p",dn,[w(o(t(a)("by "))+" ",1),l(t($t),{class:"fr-ml-1v",user:f(g).posted_by},null,8,["user"])])])]),e("td",null,[g.closed?(d(),h(q,{key:0},[w(o(t(H)(g.closed)),1)],64)):A("",!0)]),e("td",null,[n.value[g.subject.id]?(d(),h("a",{key:0,class:"fr-link inline-flex",href:r(g.id,n.value[g.subject.id]),target:"_blank"},[l(t(K),{text:r(g.id,n.value[g.subject.id]),"auto-resize":!0,"max-lines":1},null,8,["text"])],8,un)):A("",!0)])])}),256))])]),_:1},8,["loading"]))}}),fn="/_themes/gouvfr/assets/discussion.svg",_n={class:"fr-container--fluid"},mn={key:0},pn={class:"fr-breadcrumb__link","aria-current":"page"},bn={class:"fr-h3"},gn={class:"subtitle subtitle--uppercase"},vn={class:"text-align-center fr-py-1w"},hn=["src"],yn={class:"fr-text--bold fr-my-3v"},$n=S({__name:"Discussions",props:{oid:{}},setup(c){const{t:s}=M(),a=c,b=k(!1),n=k(1),r=k(10),i=k(0),f=k("created"),_=k("desc"),$=B(()=>"".concat(_.value==="asc"?"":"-").concat(f.value)),g=k([]),{currentOrganization:p}=G();function u(v,z){f.value=v,_.value=z}return X(async()=>{b.value=!0,g.value=[];try{const v=await xa(a.oid,n.value,r.value,$.value);g.value=v.data,n.value=v.page,r.value=v.page_size,i.value=v.total}finally{b.value=!1}}),(v,z)=>{const y=F("router-link");return d(),h("div",_n,[l(Y,null,{default:m(()=>[e("li",null,[l(y,{class:"fr-breadcrumb__link",to:"/"},{default:m(()=>[w(o(t(s)("Administration")),1)]),_:1})]),t(p)?(d(),h("li",mn,[l(y,{class:"fr-breadcrumb__link",to:"/"},{default:m(()=>[w(o(t(p).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",pn,o(t(s)("Discussions")),1)])]),_:1}),e("h1",bn,o(t(s)("Discussions")),1),e("h2",gn,o(t(s)("{n} discussions",i.value)),1),b.value||i.value>0?(d(),C(cn,{key:0,discussions:g.value,loading:b.value,"sort-direction":_.value,sortedBy:f.value,onSort:u},null,8,["discussions","loading","sort-direction","sortedBy"])):(d(),C(x,{key:1,class:"fr-my-2w"},{default:m(()=>[e("div",vn,[e("img",{src:t(fn),alt:"",loading:"lazy"},null,8,hn),e("p",yn,o(t(s)("There is no discussion yet")),1)])]),_:1})),i.value>r.value?(d(),C(t(le),{key:2,page:n.value,"page-size":r.value,"total-results":i.value,onChange:z[0]||(z[0]=D=>n.value=D)},null,8,["page","page-size","total-results"])):A("",!0)])}}});ut({admin_root:re,default_lang:ae.global.locale.value,only_locales:ae.global.locale.value,schema_documentation_url:ct,schema_validata_url:ft,show_copy_resource_permalink:!0,tabular_api_url:_t,tabular_page_size:mt,title:be});const wn=[{path:"/me",component:Rs,name:"me"},{path:"/organizations/:oid",children:[{path:"datasets",component:ls,props:!0,name:"organization-datasets"},{path:"reuses",component:ks,props:!0,name:"organization-reuses"},{path:"discussions",component:$n,props:!0,name:"organization-discussions"},{path:"members",component:Ca,props:!0,name:"organization-members"},{path:"profile",component:Qa,props:!0,name:"organization-profile"}]}],kn=pt({history:bt(),routes:wn}),J=Ce(Zs);gt(J);J.use(vt);J.use(ht);J.use(ae);J.use(kn);J.mount("#admin");globalThis.dsfr.start();console.log("JS is injected !");export{zn as __vite_legacy_guard};
