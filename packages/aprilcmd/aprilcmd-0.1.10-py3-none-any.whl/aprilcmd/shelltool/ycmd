#!/usr/bin/expect 
set timeout -1
set ip [lindex $argv 0]
set name [lindex $argv 1]
set pass [lindex $argv 2]
set cmd [lindex $argv 3]
spawn ssh $name@$ip
expect {
    "password" {send "$pass\r";}
    "yes/no" {send "yes\r";exp_continue}
}
expect {
	"Permission denied*" {exit -1}
        "$*" {send "$cmd\r";}
        "#*" {send "$cmd\r";}
        "~*" {send "$cmd\r";}
}
expect {
        "$*" {send "exit\r";}
        "#*" {send "exit\r";}
        "~*" {send "exit\r";}
}

expect eof
exit
