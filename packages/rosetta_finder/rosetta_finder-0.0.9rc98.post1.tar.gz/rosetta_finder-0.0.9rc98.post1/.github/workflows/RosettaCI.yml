name: Test with Rosetta

on:
  workflow_dispatch:
  push:
    paths:
      - '.github/workflows/RosettaCI.yml' # monitor the main workflow script.
      - 'src/rosetta_finder/app/*'
      - 'tests/cases/*'

    branches: [ main ]
  pull_request:
    branches: [ main ]
  release:
    types: [created]

jobs:
  RosettaTests:
    strategy:
      fail-fast: false
      matrix:
        os:
          - ubuntu-latest
        python:
          - "3.8"

    uses: YaoYinYing/action-python/.github/workflows/validation-dockerized.yml@v7.3.1-post-7
    with:
      workdir: '.'
      python-version: ${{ matrix.python }}
      docker-image: rosettacommons/rosetta:mpi
    secrets:
      CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
