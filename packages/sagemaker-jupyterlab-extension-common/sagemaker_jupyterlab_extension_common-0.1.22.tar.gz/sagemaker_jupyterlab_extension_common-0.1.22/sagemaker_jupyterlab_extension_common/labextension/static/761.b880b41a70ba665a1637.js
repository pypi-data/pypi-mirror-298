"use strict";(self.webpackChunk_amzn_sagemaker_jupyterlab_extension_common=self.webpackChunk_amzn_sagemaker_jupyterlab_extension_common||[]).push([[761],{761:(e,t,a)=>{a.r(t),a.d(t,{ILogger:()=>N,default:()=>Y,logSchemas:()=>g});var o=a(182),r=a(492);const n="@amzn/sagemaker-jupyterlab-extension-common:logger",s="@amzn/sagemaker-jupyterlab-extension-common:jumpstart-deeplinking",i=[200,201],c="/aws/sagemaker/api/context",l="/api/ai/config";var d=a(768),u=a(321),m=a.n(u);const p=(e,t,a,n)=>{const s=[],i=()=>{((e,t,a)=>{const n=r.PageConfig.getBaseUrl(),s=`${n}${a}`,i=o.ServerConnection.makeSettings({baseUrl:n}),c={method:"POST",body:JSON.stringify({events:e})},l={retries:t,onFailedAttempt:e=>{console.warn({message:`Deliver events attempt (${e.attemptNumber}) with (${e.retriesLeft}) retries remaining.`,error:e})}};m()((async()=>{let e;try{e=await o.ServerConnection.makeRequest(s,c,i)}catch(e){throw e instanceof TypeError&&Object.setPrototypeOf(e,Error.prototype),e}if(!e.ok)throw new Error(e.statusText)}),l).catch((t=>{console.error({message:`Failed to deliver events after (${l.retries}) retries.`,error:t,events:e})}))})(s.splice(0),e,n)};return setInterval(i,t),(e,t)=>{const o=a-s.length;s.push(...t.slice(0,o)),t.length>o&&(i(),console.log("Logger plugin max buffer size exceeded."))}},g={operationalLogger:{schemaId:"http://sagemaker.studio.jupyterlab.ui.log.schema",schemaVersion:1},performance:{schemaId:"http://sagemaker.studio.jupyterlab.ui.performance.schema",schemaVersion:1}},h=Object.keys(g).map((e=>g[e].schemaId)),w="__INJECT__",{name:v,version:y}=a(147),b=()=>{const e=p(2,5e3,1e4,"aws/sagemaker/api/jumpstart/eventlog");return new d.EventLog({allowedSchemas:h,handlers:[e]})},f="Cookie Preferences";var E;!function(e){e.POST="POST",e.GET="GET",e.PUT="PUT"}(E||(E={}));class _ extends Error{constructor(e,t,a,o){super(e),this.errorStatus=t,this.errorCode=a,this.cause=o,Object.setPrototypeOf(this,_.prototype)}}const S=async(e,t,a,n)=>{var s,c;const l=o.ServerConnection.makeSettings({}),d=r.URLExt.join(l.baseUrl,e),u={method:t};a&&(u.body=a),n&&(u.headers=n);const m=await o.ServerConnection.makeRequest(d,u,l);if(!i.includes(m.status)){const e=await m.json(),t=null!==(s=e.errorCode)&&void 0!==s?s:void 0,a=null!==(c=e.errorMessage)&&void 0!==c?c:"unable to fetch data";throw new _(a,m.status,t)}return m};var k=a(29),L=a.n(k),j=a(83);const C={ShortBreadFooter:a(933).css`
  color: var(--jp-ui-font-color1);
  font-family: var(--jp-ui-font-family);
  font-size: var(--jp-ui-font-size1);
  line-height: 24px;
`},O=()=>((0,k.useEffect)((()=>{(()=>{const e=document.createElement("script");e.src="https://prod.assets.shortbread.aws.dev/shortbread.js",e.type="text/javascript",e.async=!0,document.head.appendChild(e),e.onload=()=>window.AWSCShortbreadInstance=(()=>{const e=window.AWSCShortbread({domain:window.location.hostname,hasConsoleNavFooter:!0});return e.checkForCookieConsent(),e})();const t=document.createElement("link");t.href="https://prod.assets.shortbread.aws.dev/shortbread.css",t.rel="stylesheet",document.head.appendChild(t)})()}),[]),L().createElement("div",{className:C.ShortBreadFooter},L().createElement("span",{onClick:()=>{const e=window.AWSCShortbreadInstance;e&&e.customizeCookies()},style:{cursor:"pointer"}},f)));class x extends j.ReactWidget{render(){return L().createElement(O,null)}}var I=a(837);const M={id:"@amzn/sagemaker-jupyterlab-extension-common:panorama",autoStart:!0,requires:[I.IStatusBar],activate:(e,t)=>{(async e=>{try{await e.started;const t=document.getElementById("main"),a=await S(c,E.GET),o=await a.json();if(!t)throw new Error("JupyterLab application or region not found in DOM");((e,t)=>{if(!e)throw new Error("Failed to get region");const a=document.createElement("script"),o=t&&"prod"===t.toLocaleLowerCase()?"Prod":"NonProd";a.src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js",a.id="awsc-panorama-bundle",a.type="text/javascript",a.setAttribute("data-config",`{"appEntity": "aws-sagemaker", "region": "${e}", "service" :"sagemaker-jupyterlab", "domain": "${o}"}`),document.head.appendChild(a)})(o.region,o.stage)}catch(e){}})(e);const a=new x;t.registerStatusItem("@amzn/sagemaker-jupyterlab-extension-common:widget:shortbread-status",{item:a,align:"right",rank:599,isActive:()=>!0})}};var R,T=a(930);!function(e){e.TRACE="TRACE",e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e.FATAL="FATAL"}(R||(R={}));const N=new T.Token(n);var A;!function(e){e.SMStudio="SageMaker Studio",e.SMStudioSSO="SageMaker Studio SSO",e.MD="MD"}(A||(A={}));var D=a(13);class z{constructor(e,t,a){this.trace=e=>this.record(e,R.TRACE),this.debug=e=>this.record(e,R.DEBUG),this.info=e=>this.record(e,R.INFO),this.warn=e=>this.record(e,R.WARN),this.error=e=>this.record(e,R.ERROR),this.fatal=e=>this.record(e,R.FATAL),this.child=(e,t,a)=>{const o=t||this.schema,r=a||this.eventLog;return new z(r,o,{...this.context,...e})},this.eventLog=e,this.schema=t,this.context={...a,AccountId:w,SpaceName:w}}format(e,t){if("Error"in e&&void 0!==e.Error){const a={...e,Name:e.Error.name,Message:e.Error.message,Stack:e.Error.stack,Level:t,Context:this.context};return delete e.Error,a}return{...e,Level:t,Context:this.context}}record(e,t){return this.eventLog.recordEvent({version:this.schema.schemaVersion,schema:this.schema.schemaId,body:this.format(e,t)})}}const $={id:n,autoStart:!0,provides:N,activate:e=>{const t={SessionId:(e=>{const t=window.sessionStorage.getItem(e);let a;return null==t?(a={id:(0,D.v4)(),startTime:(new Date).toISOString()},window.sessionStorage.setItem(e,JSON.stringify(a))):a=JSON.parse(t),a})(n).id},a=p(2,5e3,1e4,"aws/sagemaker/api/eventlog"),o=new d.EventLog({allowedSchemas:h,handlers:[a]});return new z(o,g.operationalLogger,t)}};var V,q=a(916);!function(e){e.NOTEBOOK_NOT_AVAILABLE="NOTEBOOK_NOT_AVAILABLE",e.NOTEBOOK_SIZE_TOO_LARGE="NOTEBOOK_SIZE_TOO_LARGE",e.INVALID_REQUEST="INVALID_REQUEST",e.INTERNAL_SERVER_ERROR="INTERNAL_SERVER_ERROR"}(V||(V={}));const U={errorTitle:"Unable to open JumpStart notebook",defaultErrorMessage:"Something went wrong when opening the JumpStart notebook.",notebookNotFoundErrorMessage:"The JumpStart notebook does not exist or is not supported in the current region.",notebookSizeTooLargeErrorMessage:"The notebook size is too large.",invalidRequestErrorMessage:"A request to open the JumpStart notebook is invalid."};let F=!1;const J=async e=>(0,j.showErrorMessage)(U.errorTitle,{message:e}),P={id:s,requires:[q.IRouter,N],autoStart:!0,activate:async(e,t,a)=>{const{commands:o}=e,n="jumpstart:open-notebook-for-deeplinking",i=((e,t,a)=>{var o;const r={[s]:b()};return e.child({ExtensionName:v,ExtensionVersion:y,PluginId:t},void 0,null!==(o=r[t])&&void 0!==o?o:void 0)})(a,s);o.addCommand(n,{execute:()=>(async(e,t,a)=>{if(!F)try{const{search:o}=e.current;if(!o)return await J(U.invalidRequestErrorMessage),void a.error({Error:new Error("Invalid deep-linking parameters: Query params must be specified")});const{key:n,model_id:s,endpoint_name:i,resource_type:c,inference_component:l,set_default_kernel:d,cluster_id:u}=r.URLExt.queryStringToObject(o);if(!n)return await J(U.invalidRequestErrorMessage),void a.error({Error:new Error("Invalid deep-linking parameters: the notebook key must be specified.")});const m={key:n,...c&&{resource_type:c},...s&&{model_id:s},...i&&{endpoint_name:i},...l&&{inference_component:l},...d&&{set_default_kernel:d},...u&&{cluster_id:u}},p=await(async(e,t)=>{const a=(0,D.v4)();let o;t.info({Message:"Fetching JumpStart Notebook",ClientRequestId:a});try{o=await S("aws/sagemaker/api/jumpstart/notebook",E.POST,JSON.stringify(e),{"x-client-req-id":a})}catch(e){throw t.error({Error:new Error(`Error executing open notebook: ${e}`),ClientRequestId:a}),e}const r=o.headers.get("x-server-req-id")||"SERVER_REQUEST_ID_MISSING";t.info({Message:"Successfully fetched JumpStart Notebook",ClientRequestId:a,ServerRequestId:r});const n=await o.json(),{notebookPath:s}=n;return s})(m,a);t.restored.then((()=>{t.commands.execute("docmanager:open",{factory:"Notebook",path:p})})),a.info({Message:"Successfully loaded the JumpStart Deeplinking plugin"})}catch(e){return e instanceof _?void await(async e=>{switch(e){case V.NOTEBOOK_NOT_AVAILABLE:await J(U.notebookNotFoundErrorMessage);break;case V.NOTEBOOK_SIZE_TOO_LARGE:await J(U.notebookSizeTooLargeErrorMessage);break;case V.INVALID_REQUEST:await J(U.invalidRequestErrorMessage);break;case V.INTERNAL_SERVER_ERROR:default:await J(U.defaultErrorMessage)}})(V[e.errorCode]):(await J(U.defaultErrorMessage),void a.error({Error:new Error(`Error executing open notebook: ${e}`)}))}finally{F=!0}})(t,e,i)}),t.register({command:n,pattern:new RegExp("[?]command=open-jumpstart-notebook"),rank:10})}},B=new(a(444).LabIcon)({name:"@amzn/sagemaker-jupyterlab-extension-common:q-icon",svgstr:'<svg class="jp-icon3" width="20" height="20" viewBox="0 0 20 20" fill="#616161" xmlns="http://www.w3.org/2000/svg">\n  <path\n    d="M10.0065 16.251C10.2128 16.251 10.3509 16.201 10.3943 16.176L10.3959 16.1792L14.8923 13.5652L10.6286 11.0872L10.1864 11.3434C10.1321 11.3762 10.0701 11.3918 10.008 11.3918C9.94594 11.3918 9.88543 11.3762 9.82958 11.3434L8.9452 10.8294C8.83504 10.7637 8.76677 10.645 8.76677 10.5169V9.48879C8.76677 9.35911 8.83504 9.24036 8.9452 9.1763L9.82958 8.66226C9.88388 8.62945 9.94594 8.61382 10.008 8.61382C10.0701 8.61382 10.1306 8.62945 10.1864 8.66226L11.0708 9.1763C11.181 9.24192 11.2492 9.36067 11.2492 9.48879V10.0028L15.5129 12.4809V7.25138C15.5129 7.05451 15.2957 6.67484 15.125 6.5764L10.3943 3.82651C10.3493 3.79995 10.2128 3.75151 10.0065 3.75151C9.8001 3.75151 9.66201 3.80151 9.61857 3.82651L4.88791 6.5764C4.71724 6.67484 4.50002 7.05295 4.50002 7.25138V12.7512C4.50002 12.948 4.71724 13.3277 4.88791 13.4261L9.61857 16.176C9.66356 16.2026 9.8001 16.251 10.0065 16.251Z"\n  />\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M2.52517 3.87524L8.4831 0.411312C9.42643 -0.137104 10.5901 -0.137104 11.5334 0.411312L17.4914 3.87524C18.4347 4.42366 19.0165 5.43924 19.0165 6.53607V13.4639C19.0165 14.5623 18.4347 15.5763 17.4914 16.1248L11.5334 19.5887C10.5901 20.1371 9.42643 20.1371 8.4831 19.5887L2.52517 16.1248C1.58183 15.5763 1 14.5623 1 13.4639V6.53607C1 5.43924 1.58183 4.42522 2.52517 3.87524ZM11.015 2.74218L15.7456 5.49207C16.3011 5.81393 16.7541 6.60453 16.7541 7.24981V12.7496C16.7541 13.3933 16.2995 14.1855 15.7456 14.5073L11.015 17.2572C10.7372 17.4182 10.3726 17.4994 10.0065 17.4994C9.64029 17.4994 9.27568 17.4182 8.99795 17.2572L4.26729 14.5073C3.71184 14.1855 3.25879 13.3949 3.25879 12.7496V7.24981C3.25879 6.60609 3.71339 5.81393 4.26729 5.49207L8.99795 2.74218C9.27568 2.58125 9.64029 2.5 10.0065 2.5C10.3726 2.5 10.7372 2.58125 11.015 2.74218Z"\n  />\n</svg>'}),G="api/contents",W=".aws",Q=W+"/sso",K=W+"/amazon_q",Z=W+"/enabled_features",H="amazon-q:Q-Developer";class X{constructor(e){this.app=e,this.putDirectory=async(e,t)=>await S(`${G}/${e}`,E.PUT,JSON.stringify({type:"directory",format:"text",name:t})),this.getAllowedDomains=async()=>{if(!this.region)try{const e=await S(c,E.GET),t=await e.json();this.region=t.region}catch(e){}const e=this.region;return[`.v2.${e}.beta.app.iceland.aws.dev`,`.v2.niceland-gamma.${e}.on.aws`,`.datazone.${e}.on.aws`]},this.isMessageOriginValid=(e,t)=>this.isLocalhost()?"http://localhost:5173"===e.origin:t.some((t=>e.origin.endsWith(t))),this.putMetadataFile=async(e,t,a,o)=>await S(`${G}/${e?`${e}/${t}.${a}`:`/${t}.${a}`}`,E.PUT,JSON.stringify({content:JSON.stringify(o),format:"text",name:`${t}.${a}`,type:"file"})),this.messageListener=async e=>{const t=await this.getAllowedDomains();if(this.isMessageOriginValid(e,t))try{const t=JSON.parse(e.data);if(!("accessToken"in t))throw new Error("IAM Identity Center access token not found.");this.updateMetadata(t)}catch(e){}}}async initialize(){const e=await this.postAuthDetails();(null==e?void 0:e.environment)===A.SMStudioSSO?e.isQDeveloperEnabled&&this.initializeSMInterval():(null==e?void 0:e.environment)===A.MD&&this.initializeTwoWayIframeCommunication(),this.initialLanguageModel&&this.initialLanguageModel!==H||function(e){if(e.shell instanceof q.LabShell){const t=Array.from(e.shell.widgets("left")).find((e=>"jupyter-ai::chat"===e.id));t&&(t.title.icon=B)}}(this.app)}async initializeSMInterval(){this.smInterval||(this.smInterval=setInterval((async()=>{await this.postAuthDetails()}),3e5))}async updateMetadata(e){var t,a;await this.createDirectoryIfDoesNotExist(W,".aws"),await this.createDirectoryIfDoesNotExist(Q,"sso"),await this.createDirectoryIfDoesNotExist(K,"amazon_q"),await this.createDirectoryIfDoesNotExist(Z,"enabled_features"),await this.putMetadataFile(Q,"idc_access_token","json",{idc_access_token:e.accessToken}),await this.putMetadataFile(K,"q_dev_profile","json",{q_dev_profile_arn:null!==(t=e.profileArn)&&void 0!==t?t:""}),await this.putMetadataFile(Z,"enabled_features","json",{enabled_features:null!==(a=e.enabledFeatures)&&void 0!==a?a:[]})}async updateInitialLanguageModelConfig(){const e=await this.postAuthDetails(),t=await this.getLanguageModelConfig();this.initialLanguageModel=null==t?void 0:t.model_provider_id,(null==e?void 0:e.environment)===A.SMStudio?(null==t?void 0:t.model_provider_id)||(await this.updateLanguageModelConfig(H),this.initialLanguageModel=H):(null==e?void 0:e.environment)===A.SMStudioSSO&&(e.isQDeveloperEnabled?(null==t?void 0:t.model_provider_id)!==H&&(await this.updateLanguageModelConfig(H),this.initialLanguageModel=H):(null==t?void 0:t.model_provider_id)||(await this.updateLanguageModelConfig(H),this.initialLanguageModel=H))}async getLanguageModelConfig(){try{const e=await S(l,E.GET);return await e.json()}catch{return}}async updateLanguageModelConfig(e){try{await S(l,E.POST,JSON.stringify({model_provider_id:e}))}catch{return}}async postAuthDetails(){try{const e=await S("/aws/sagemaker/api/auth-details",E.POST);return await e.json()}catch{return}}async getDirectory(e,t){try{return await S(`${G}/${e}?content=${t?1:0}`,E.GET)}catch{return}}sendMessageWhenReadyToReceiveUserMetadata(){var e;null===(e=window.top)||void 0===e||e.postMessage("JL_COMMON_PLUGIN_LOADED","*")}async createDirectoryIfDoesNotExist(e,t){await this.getDirectory(e,!1)||await this.putDirectory(e,t)}isLocalhost(){return["localhost","127.0.0.1"].some((e=>document.location.href.includes(e)))}initializeTwoWayIframeCommunication(){window.addEventListener("message",this.messageListener),this.sendMessageWhenReadyToReceiveUserMetadata()}}const Y=[M,$,P,{id:"@amzn/sagemaker-jupyterlab-extension-common:q-developer",autoStart:!0,activate:async e=>{const t=new X(e);await t.updateInitialLanguageModelConfig(),e.restored.then((async()=>{t.initialize()}))}}]},147:e=>{e.exports=JSON.parse('{"name":"@amzn/sagemaker-jupyterlab-extension-common","description":"SageMaker JupyterLab workspace common module","version":"0.1.22","author":"Amazon","homepage":"https://aws.amazon.com/sagemaker/","license":"Amazon Software License","licenses":[{"type":"Amazon Software License","url":"http://aws.amazon.com/asl"}],"directories":{"test":"__tests__"},"files":["lib/**/*.{d.ts,eot,gif,html,jpg,js,js.map,json,png,svg,woff2,ttf}","style/**/*.{css,js,eot,gif,html,jpg,json,png,svg,woff2,ttf}","schema/*.json"],"scripts":{"build":"tsc","build:labextension":"tsc && jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True --source-map True .","lint:check":"eslint . --ext .js,.ts,.tsx","lint:fix":"eslint --fix . --ext .js,.ts,.tsx","release":"run-s build","install:extension":"jlpm run build","watch:src":"tsc -w","watch:labextension":"jupyter labextension watch .","watch":"run-p watch:src watch:labextension","test":"jest","dev:setup":"run-s -n dev:docker:build dev:docker:reset dev:docker:create","dev:docker:build":"(cd devSetup ; sh pull-jupyterlab-base-image.sh && docker build . --tag jupyterlab_ext_dev_image_common --build-arg CONTAINER_USER_ID=$(id -u) --build-arg CONTAINER_GROUP_ID=$(id -g))","dev:docker:reset":"docker stop jupyterlab_ext_dev_container_common || true && docker rm jupyterlab_ext_dev_container_common || true","dev:docker:create":"docker create --name jupyterlab_ext_dev_container_common --publish 8888:8888 --volume $(pwd):/sagemaker-studio-extension --volume $HOME/.aws:/home/sagemaker-user/.aws jupyterlab_ext_dev_image_common","dev:start":"docker start jupyterlab_ext_dev_container_common --attach","test:watch":"jest --watch"},"main":"lib/index.js","dependencies":{"@emotion/css":"^11.1.3","@jupyterlab/application":"^4.0.5","@jupyterlab/apputils":"^4.0.5","@jupyterlab/ui-components":"^4.0.5","@jupyterlab/coreutils":"^6.0.5","@jupyterlab/jupyterlab-telemetry":"^1.0.3","@jupyterlab/services":"^7.0.0","@jupyterlab/statusbar":"^4.0.5","@lumino/coreutils":"^2.1.2","@lumino/signaling":"^2.1.2","@lumino/widgets":"^2.1.2","@testing-library/jest-dom":"^6.1.6","isomorphic-fetch":"^3.0.0","p-retry":"^6.1.0","react":"^18.2.0","uuid":"^9.0.1"},"jupyterlab":{"extension":true,"outputDir":"sagemaker_jupyterlab_extension_common/labextension"},"devDependencies":{"@babel/preset-env":"^7.22.7","@babel/preset-react":"^7.22.5","@jupyterlab/builder":"^4.0.5","@testing-library/react":"^13.0.0","@types/jest":"^29.5.12","@types/lodash":"^4.14.172","@types/uuid":"^9.0.6","@typescript-eslint/eslint-plugin":"^5.61.0","eslint-config-prettier":"^8.8.0","eslint-plugin-import":"^2.27.5","eslint-plugin-json":"^3.1.0","eslint-plugin-prettier":"^4.2.1","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","jest":"^28.0.0","jest-environment-jsdom":"^29.7.0","npm-run-all":"^4.1.5","prettier":"^2.4.1","ts-jest":"^28.0.5","typescript":"^4.3.5"}}')}}]);