{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>登录</title>
  {% include 'common/header.html' %}
  <link rel="stylesheet" href="{% static 'other/css/login.css' %}"/>
</head>
<body class="login-body" background="{% static 'images/background.svg' %}">
<form class="layui-form" action="javascript:void(0);">
  <div class="layui-form-item">
    <img class="logo" src="{% static 'images/logo.png' %}"/>
    <div class="title">{{ frontend_name }}</div>
    <div class="desc">
      最 快 速 最 便 捷 的 管 理 后 台 之 一
    </div>
  </div>
  <div class="layui-form-item">
    <input name="username" type="text" placeholder="用户名：" value="" hover class="layui-input"/>
  </div>
  <div class="layui-form-item">
    <input name="password" type="password" placeholder="密码：" value="" hover class="layui-input"/>
  </div>
  <div class="layui-form-item">
    <input placeholder="验证码 : " name="captcha" hover class="code layui-input layui-input-inline"/>
    <img src="{% url 'generate_captcha' %}" class="codeImage" id="captchaImage"/>
  </div>
  <div class="layui-form-item">
    <input type="checkbox" name="remember-me" title="记住密码" lay-skin="primary">
  </div>
  <div class="layui-form-item">
    <button type="submit" class="layui-btn layui-btn-radius" lay-submit lay-filter="login">
      登 入
    </button>
  </div>
</form>
{% include 'common/footer.html' %}

<script>
  layui.use(['form', 'layer'], function () {
    let form = layui.form;
    let layer = layui.layer;
    let $ = layui.jquery;

    // 登录表单提交
    form.on('submit(login)', function (data) {
      $.ajax({
        url: "{% url 'admin_api_login' %}",
        type: "POST",
        data: JSON.stringify(data.field),
        contentType: "application/json",
        dataType: "json",
        success: function (data) {
          let msg = data.msg;
          if (data.code === 200) {
            layer.msg(msg, {icon: 1, time: 1000}, function () {
              window.location.href = "{% url 'home_index' %}";
            });
          } else {
            layer.msg(msg, {icon: 2, time: 3000});
          }
        },
        error: function (data) {
          layer.msg('服务器错误', {icon: 2, time: 3000});
        }
      });
      return false;
    });

    // 点击验证码图片刷新
    $('#captchaImage').click(function () {
      $(this).attr('src', "{% url 'generate_captcha' %}?t=" + Math.random());
    });
  });
</script>
<script>
  if (window !== top) {
    top.location.href = location.href;
  }
</script>
</body>
</html>